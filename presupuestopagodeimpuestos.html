<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Tax Services Quote 2025 - SECURE ASSETS HOLDING LLC</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #0f172a;
            --primary-light: #1e293b;
            --primary-gradient: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #2563eb 100%);
            --accent: #fbbf24;
            --accent-dark: #f59e0b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            width: 100%;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            padding: 30px 20px;
            color: var(--gray-800);
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            width: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
            box-sizing: border-box;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: var(--shadow-2xl);
            border-radius: 20px;
            overflow: visible;
            animation: fadeInUp 0.6s ease-out;
            width: 100%;
            box-sizing: border-box;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* HEADER PROFESIONAL PREMIUM */
        .letterhead {
            background: var(--primary-gradient);
            color: white;
            padding: 50px 50px 40px;
            position: relative;
            overflow: hidden;
        }
        
        .letterhead::before {
            content: '';
            position: absolute;
            top: -30%;
            right: -5%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%);
            border-radius: 50%;
        }
        
        .letterhead::after {
            content: '';
            position: absolute;
            bottom: -20%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(251,191,36,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }
        
        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: relative;
            z-index: 1;
            gap: 40px;
            margin-bottom: 30px;
        }
        
        .company-logo {
            flex: 1;
        }
        
        .company-logo h1 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 38px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .company-logo h1:last-of-type {
            color: var(--accent);
            font-size: 28px;
            margin-top: -5px;
        }
        
        .company-logo p {
            font-size: 14px;
            opacity: 0.95;
            font-weight: 400;
            letter-spacing: 0.5px;
            margin-top: 8px;
        }
        
        .company-info {
            text-align: right;
            font-size: 13px;
            line-height: 2;
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(10px);
            padding: 20px 25px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .company-info > div:first-child {
            background: rgba(251,191,36,0.15);
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(251,191,36,0.3);
        }
        
        .document-title {
            text-align: center;
            margin-top: 35px;
            padding-top: 35px;
            border-top: 2px solid rgba(255,255,255,0.2);
            position: relative;
            z-index: 1;
        }
        
        .document-title h2 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .document-number {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 10px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* METADATA BAR PREMIUM */
        .metadata-bar {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 28px 50px;
            border-bottom: 3px solid var(--accent);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            box-shadow: var(--shadow-sm);
        }
        
        .metadata-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Estilo especial para el item de contrase√±a */
        .metadata-item:last-child {
            grid-column: 1 / -1;
            flex-direction: column;
            align-items: flex-start;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .metadata-item label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 13px;
            white-space: nowrap;
            min-width: fit-content;
        }
        
        .metadata-item input {
            flex: 1;
            padding: 11px 15px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 14px;
            background: white;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .metadata-item input[readonly] {
            background: var(--gray-100);
            cursor: not-allowed;
            opacity: 0.9;
            border-color: var(--gray-300);
        }
        
        .metadata-item input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(251,191,36,0.1);
            transform: translateY(-1px);
        }
        
        .metadata-item input[readonly]:focus {
            border-color: var(--gray-300);
            box-shadow: none;
            transform: none;
        }
        
        /* CONTENT PREMIUM */
        .content {
            padding: 50px;
            background: white;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
            overflow: visible;
        }
        
        .section {
            margin-bottom: 45px;
            page-break-inside: avoid;
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: backwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .section-header {
            background: var(--primary-gradient);
            color: white;
            padding: 18px 28px;
            margin-bottom: 28px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            font-size: 17px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .section-number {
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        /* SUBSECCIONES PREMIUM */
        .subsection {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .subsection:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .subsection-title {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 20px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* GRID DE FORMULARIO PREMIUM */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
        
        .form-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }
        
        .form-grid-full {
            grid-column: 1 / -1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
            font-size: 14px;
            letter-spacing: 0.2px;
        }
        
        .form-group label .required {
            color: var(--danger);
            margin-left: 3px;
            font-weight: 700;
        }
        
        .form-group label .hint {
            font-weight: 400;
            color: var(--gray-500);
            font-size: 12px;
            display: block;
            margin-top: 4px;
            font-style: italic;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 13px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            background: white;
            color: var(--gray-800);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(251,191,36,0.1);
            transform: translateY(-1px);
        }
        
        .form-group input[readonly],
        .form-group select[disabled] {
            background: var(--gray-100);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .form-group.highlight input {
            background: linear-gradient(135deg, #fff9e6 0%, #fffef5 100%);
            border-color: var(--accent);
            font-weight: 600;
        }
        
        /* CLIENTE DUAL PREMIUM */
        .dual-client {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 35px;
        }
        
        .client-column {
            background: white;
            padding: 30px;
            border-radius: 16px;
            border: 2px solid var(--gray-200);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .client-column::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .client-column:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-3px);
            border-color: var(--accent);
        }
        
        .client-column h4 {
            background: var(--primary-gradient);
            color: white;
            padding: 14px 20px;
            margin: -30px -30px 25px -30px;
            border-radius: 0;
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-md);
        }
        
        /* SERVICIOS PREMIUM */
        .service-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--primary-gradient);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .service-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(251,191,36,0.05) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        .service-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-5px) scale(1.01);
            border-color: var(--accent);
        }
        
        .service-card:hover::after {
            opacity: 1;
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-left: 20px;
            position: relative;
            z-index: 1;
        }
        
        .service-title {
            flex: 1;
        }
        
        .service-title h3 {
            color: var(--gray-900);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.3;
            letter-spacing: -0.3px;
        }
        
        .service-title .subtitle {
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 400;
            font-style: italic;
        }
        
        .price-box {
            text-align: right;
            min-width: 200px;
        }
        
        .price-label {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .price-input {
            width: 100%;
            padding: 14px 18px;
            border: 3px solid var(--accent);
            border-radius: 12px;
            font-size: 22px;
            font-weight: 800;
            text-align: right;
            background: linear-gradient(135deg, #fff9e6 0%, #fffef5 100%);
            color: var(--gray-900);
            box-shadow: 0 4px 12px rgba(251,191,36,0.2);
            transition: all 0.3s ease;
        }
        
        .price-input:focus {
            outline: none;
            border-color: var(--accent-dark);
            box-shadow: 0 0 0 6px rgba(251,191,36,0.15), 0 6px 20px rgba(251,191,36,0.3);
            transform: scale(1.02);
        }
        
        .service-description {
            padding-left: 20px;
            color: var(--gray-700);
            font-size: 14px;
            line-height: 1.9;
            position: relative;
            z-index: 1;
        }
        
        .service-description ul {
            margin: 20px 0;
            padding-left: 25px;
        }
        
        .service-description li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 8px;
        }
        
        .service-description li::marker {
            color: var(--accent);
            font-weight: 700;
        }
        
        .service-description li::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 8px;
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
        }
        
        .service-description strong {
            color: var(--gray-900);
            font-weight: 700;
            letter-spacing: -0.2px;
        }
        
        /* OPCIONES DE RADIO PREMIUM */
        .radio-options {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 28px;
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: var(--shadow-sm);
        }
        
        .radio-option {
            background: white;
            border: 3px solid var(--gray-200);
            border-radius: 16px;
            padding: 22px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }
        
        .radio-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-gradient);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .radio-option:hover {
            border-color: var(--accent);
            background: linear-gradient(135deg, #fff9e6 0%, white 100%);
            box-shadow: var(--shadow-lg);
            transform: translateX(5px);
        }
        
        .radio-option:hover::before {
            transform: scaleY(1);
        }
        
        .radio-option input[type="radio"] {
            width: 24px;
            height: 24px;
            margin-right: 18px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: var(--accent);
        }
        
        .radio-option-content {
            flex: 1;
        }
        
        .radio-option-title {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 6px;
            font-size: 15px;
            letter-spacing: -0.2px;
        }
        
        .radio-option-desc {
            font-size: 13px;
            color: var(--gray-600);
            line-height: 1.6;
        }
        
        .radio-option .price-input {
            width: 150px;
            margin-left: 20px;
            flex-shrink: 0;
            font-size: 20px;
        }
        
        .radio-option input[type="radio"]:checked ~ .radio-option-content .radio-option-title {
            color: var(--success);
        }
        
        .radio-option:has(input[type="radio"]:checked) {
            border-color: var(--success);
            background: linear-gradient(135deg, #ecfdf5 0%, white 100%);
            box-shadow: 0 0 0 4px rgba(16,185,129,0.1), var(--shadow-lg);
        }
        
        .radio-option:has(input[type="radio"]:checked)::before {
            background: linear-gradient(180deg, var(--success) 0%, #059669 100%);
            transform: scaleY(1);
        }
        
        .recommended-badge {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 11px;
            margin-left: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(16,185,129,0.3);
            text-transform: uppercase;
        }
        
        /* BUSINESS INFO */
        .business-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        /* TABLA FISCAL PREMIUM */
        .tax-table {
            width: 100%;
            max-width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 28px 0;
            box-shadow: var(--shadow-xl);
            border-radius: 16px;
            overflow: hidden;
            background: white;
            table-layout: auto;
            box-sizing: border-box;
        }
        
        .tax-table thead {
            background: var(--primary-gradient);
            color: white;
        }
        
        .tax-table th {
            padding: 20px 18px;
            text-align: left;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }
        
        .tax-table th:first-child {
            padding-left: 24px;
        }
        
        .tax-table th:last-child {
            padding-right: 24px;
        }
        
        .tax-table td {
            padding: 18px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            transition: all 0.2s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 0;
        }
        
        .tax-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .tax-table tbody tr:hover {
            background: linear-gradient(90deg, var(--gray-50) 0%, white 100%);
            transform: scale(1.01);
        }
        
        .tax-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .tax-table tbody tr:last-child td:first-child {
            border-bottom-left-radius: 16px;
        }
        
        .tax-table tbody tr:last-child td:last-child {
            border-bottom-right-radius: 16px;
        }
        
        .tax-rate {
            font-weight: 800;
            color: var(--primary);
            font-size: 16px;
            background: linear-gradient(135deg, var(--gray-100) 0%, white 100%);
            padding: 6px 14px;
            border-radius: 8px;
            display: inline-block;
        }
        
        /* RESUMEN PREMIUM */
        .summary-table {
            width: 100%;
            max-width: 100%;
            margin: 32px 0;
            border-collapse: collapse;
            border-spacing: 0;
            box-shadow: var(--shadow-xl);
            border-radius: 16px;
            overflow: hidden;
            background: white;
            table-layout: fixed;
            box-sizing: border-box;
        }
        
        .summary-table thead {
            background: var(--primary-gradient);
            color: white;
        }
        
        .summary-table th {
            padding: 20px 15px;
            text-align: left;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .summary-table th:first-child {
            width: 40%;
        }
        
        .summary-table th:nth-child(2) {
            width: 35%;
        }
        
        .summary-table th:last-child {
            width: 25%;
            text-align: right;
        }
        
        .summary-table td {
            padding: 18px 15px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            transition: all 0.2s ease;
            word-wrap: break-word;
            overflow-wrap: break-word;
            vertical-align: top;
        }
        
        .summary-table td:last-child {
            text-align: right;
            white-space: nowrap;
        }
        
        .summary-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .summary-table tbody tr:nth-child(even) {
            background: var(--gray-50);
        }
        
        .summary-table tbody tr:hover {
            background: linear-gradient(90deg, var(--gray-100) 0%, var(--gray-50) 100%);
        }
        
        .summary-table .total-row {
            background: var(--primary-gradient);
            color: white;
            font-weight: 800;
            font-size: 20px;
        }
        
        .summary-table .total-row td {
            border: none;
            padding: 28px 18px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .amount {
            text-align: right !important;
            font-weight: 700;
            color: var(--gray-900);
            font-size: 15px;
            white-space: nowrap;
            display: inline-block;
        }
        
        .total-row .amount {
            color: white;
            font-size: 28px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
            white-space: nowrap;
        }
        
        .summary-table .total-row td {
            padding: 28px 15px !important;
        }
        
        /* TERMS & CONDITIONS PREMIUM */
        .terms-section {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 32px;
            border-radius: 16px;
            border: 2px solid var(--gray-200);
            margin-top: 35px;
            box-shadow: var(--shadow-md);
        }
        
        .terms-section h4 {
            color: var(--gray-900);
            margin-bottom: 22px;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.3px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .terms-section ul {
            margin-left: 25px;
            font-size: 13px;
            color: var(--gray-700);
            line-height: 2;
        }
        
        .terms-section li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 8px;
        }
        
        .terms-section li::marker {
            color: var(--accent);
            font-weight: 700;
        }
        
        /* SIGNATURE SECTION PREMIUM */
        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 45px;
            margin-top: 50px;
            page-break-inside: avoid;
        }
        
        .signature-box {
            text-align: center;
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            padding: 35px;
            border-radius: 16px;
            border: 2px solid var(--gray-200);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        
        .signature-box:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-3px);
            border-color: var(--accent);
        }
        
        .signature-line {
            border-top: 3px solid var(--gray-700);
            margin: 70px 25px 15px 25px;
            position: relative;
        }
        
        .signature-line::before,
        .signature-line::after {
            content: '';
            position: absolute;
            top: -2px;
            width: 10px;
            height: 10px;
            border: 2px solid var(--gray-700);
            border-radius: 50%;
            background: white;
        }
        
        .signature-line::before {
            left: -5px;
        }
        
        .signature-line::after {
            right: -5px;
        }
        
        .signature-label {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .signature-name {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
            font-size: 16px;
            letter-spacing: 0.3px;
        }
        
        /* BOTONES PREMIUM */
        .action-buttons {
            display: flex;
            gap: 18px;
            justify-content: center;
            padding: 40px;
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border-top: 3px solid var(--accent);
        }
        
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-lg);
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: var(--shadow-2xl);
        }
        
        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .btn span {
            position: relative;
            z-index: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        /* ALERTS PREMIUM */
        .alert {
            padding: 20px 24px;
            border-radius: 14px;
            margin: 20px 0;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            box-shadow: var(--shadow-md);
            border-left: 5px solid;
            position: relative;
            overflow: hidden;
        }
        
        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(0,0,0,0.1) 10px,
                rgba(0,0,0,0.1) 20px
            );
        }
        
        .alert-info {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border-left-color: #0284c7;
            color: #0c4a6e;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%);
            border-left-color: #f59e0b;
            color: #92400e;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%);
            border-left-color: var(--success);
            color: #065f46;
        }
        
        /* CHECKBOX GROUPS */
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-size: 13px;
        }
        
        /* PRINT STYLES */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            
            .action-buttons,
            .no-print {
                display: none !important;
            }
            
            .section {
                page-break-inside: avoid;
            }
            
            .service-card {
                page-break-inside: avoid;
            }
            
            .letterhead::before {
                display: none;
            }
            
            input, select, textarea {
                border: none !important;
                border-bottom: 1px solid #ddd !important;
                box-shadow: none !important;
                background: transparent !important;
            }
            
            .price-input {
                border: 1px solid #ddd !important;
                background: transparent !important;
            }
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            body {
                padding: 10px 5px;
            }
            
            .container {
                border-radius: 10px;
                margin: 0;
            }
            
            .letterhead {
                padding: 30px 20px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .form-grid,
            .form-grid-3,
            .dual-client,
            .signature-section {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            .metadata-bar {
                grid-template-columns: 1fr !important;
                gap: 15px;
                padding: 20px 15px;
            }
            
            .metadata-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .metadata-item input {
                width: 100%;
            }
            
            .company-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .company-info {
                text-align: center;
                margin-top: 15px;
                font-size: 13px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                padding: 12px 20px;
                font-size: 14px;
            }
            
            /* Firma digital responsive */
            #signatureGrid {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            #clientDigitalSignature {
                width: 100% !important;
                max-width: 100% !important;
                height: 250px !important;
                min-height: 250px;
            }
            
            /* Contenedor del canvas responsive */
            #clientDigitalSignature {
                touch-action: none;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }
            
            /* Controles de firma responsive */
            .signature-controls {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 10px !important;
            }
            
            .signature-controls > div {
                width: 100% !important;
                justify-content: space-between;
            }
            
            /* Botones de firma responsive */
            .signature-controls button {
                width: 100%;
                padding: 10px;
            }
            
            /* Secciones responsive */
            .section {
                margin-bottom: 25px;
            }
            
            .subsection {
                padding: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            /* Tablas responsive - Prevenir desbordamiento */
            .tax-table,
            .summary-table {
                width: 100% !important;
                max-width: 100% !important;
                table-layout: fixed !important;
                word-wrap: break-word;
                display: table !important;
            }
            
            .tax-table th,
            .summary-table th {
                padding: 12px 8px !important;
                font-size: 11px !important;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .summary-table th:first-child {
                width: 35% !important;
            }
            
            .summary-table th:nth-child(2) {
                width: 40% !important;
            }
            
            .summary-table th:last-child {
                width: 25% !important;
                text-align: right !important;
            }
            
            .tax-table td,
            .summary-table td {
                padding: 12px 8px !important;
                font-size: 12px !important;
                word-wrap: break-word;
                overflow-wrap: break-word;
                vertical-align: top;
            }
            
            .summary-table td:last-child {
                text-align: right !important;
                white-space: nowrap !important;
            }
            
            .amount {
                text-align: right !important;
                font-size: 13px !important;
                white-space: nowrap !important;
                display: inline-block;
            }
            
            .total-row .amount {
                font-size: 18px !important;
                white-space: nowrap !important;
            }
            
            .summary-table .total-row td {
                padding: 20px 8px !important;
            }
            
            /* Tablas responsive */
            .tax-table,
            .summary-table {
                width: 100% !important;
                max-width: 100% !important;
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tax-table thead,
            .tax-table tbody,
            .tax-table tr,
            .summary-table thead,
            .summary-table tbody,
            .summary-table tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }
            
            .tax-table td,
            .tax-table th,
            .summary-table td,
            .summary-table th {
                padding: 12px 10px !important;
                font-size: 12px !important;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .amount {
                text-align: right !important;
                font-size: 13px !important;
            }
            
            .total-row .amount {
                font-size: 18px !important;
            }
            table {
                font-size: 12px;
            }
            
            /* Headers responsive */
            .section-header {
                font-size: 14px;
                padding: 12px 15px;
            }
        }
        
        /* Responsive para pantallas muy peque√±as */
        @media (max-width: 480px) {
            body {
                padding: 5px 0;
            }
            
            .letterhead {
                padding: 20px 15px;
            }
            
            .letterhead h1 {
                font-size: 20px !important;
            }
            
            .content {
                padding: 15px 10px;
            }
            
            #clientDigitalSignature {
                height: 200px !important;
                min-height: 200px;
            }
            
            .metadata-bar {
                padding: 15px 10px;
            }
            
            input, select, textarea {
                font-size: 16px !important; /* Evita zoom en iOS */
            }
        }
        
        /* Estilos espec√≠ficos para canvas de firma */
        #clientDigitalSignature {
            touch-action: none !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            user-select: none !important;
            -webkit-tap-highlight-color: transparent;
            -ms-touch-action: none;
        }
        
        #clientDigitalSignature:active {
            cursor: crosshair;
        }
        
        /* Prevenir scroll mientras se firma en m√≥vil */
        body.signing {
            overflow: hidden !important;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        
        /* Asegurar que se remueva la clase signing */
        body:not(.signing) {
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }
        
        /* Mejorar √°rea t√°ctil en m√≥vil */
        @media (max-width: 768px) {
            #clientDigitalSignature {
                touch-action: none !important;
                -ms-touch-action: none !important;
            }
            
            /* Contenedor del canvas para m√≥vil */
            #clientDigitalSignature {
                width: 100% !important;
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LETTERHEAD -->
        <div class="letterhead">
            <div class="company-header">
                <div class="company-logo" style="display: flex; align-items: center; gap: 20px;">
                    <div id="logoContainer" style="display: none;">
                        <img id="companyLogo" src="" alt="SECURE ASSETS HOLDING LLC Logo" style="max-height: 80px; max-width: 200px; object-fit: contain;">
                    </div>
                    <div>
                        <h1>SECURE ASSETS HOLDING LLC</h1>
                        <p>Professional Tax Preparation Services</p>
                    </div>
                </div>
                <div class="company-info">
                    <div style="background: rgba(255,255,255,0.15); padding: 12px 16px; border-radius: 8px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.2);">
                        <div style="margin-bottom: 6px;"><strong>PTIN:</strong> <span style="color: #ffc107; font-weight: 700; font-size: 14px;">P03429037</span></div>
                        <div style="margin-bottom: 6px;"><strong>Status:</strong> <span style="color: #28a745; font-weight: 600;">‚úì Active</span></div>
                        <div><strong>Valid For Calendar Year(s):</strong> <span style="font-weight: 600;">2025, 2026</span></div>
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <div style="margin-bottom: 6px;"><strong>State:</strong> <span style="opacity: 0.9;">Federal (all states)</span></div>
                        <div style="margin-bottom: 6px;"><strong>Phone:</strong> <span style="opacity: 0.9;">347-547-5640</span></div>
                        <div><strong>Email:</strong> <span style="opacity: 0.9;">janinehubner@secureassetshldg.com</span></div>
                    </div>
                </div>
            </div>
            <div class="document-title">
                <h2>TAX SERVICES QUOTE 2025</h2>
                <div class="document-number">
                    Quote #: <input type="text" id="quoteNumber" value="ET-2025-001" style="background: transparent; border: none; border-bottom: 1px solid rgba(255,255,255,0.5); color: white; width: 120px; text-align: center;">
                </div>
            </div>
        </div>

        <!-- METADATA BAR -->
        <div class="metadata-bar">
            <div class="metadata-item">
                <label>Prepared by:</label>
                <input type="text" id="preparador" value="JANINE TERAN">
            </div>
            <div class="metadata-item">
                <label>Issue Date:</label>
                <input type="date" id="fechaEmision" readonly>
            </div>
            <div class="metadata-item">
                <label>Valid Until:</label>
                <input type="date" id="fechaValidez" readonly>
            </div>
            <div class="metadata-item" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 16px; width: 100%;">
                <label style="color: #92400e; font-weight: 700; display: flex; align-items: center; gap: 6px; margin-bottom: 10px; font-size: 14px;">
                    üîê Client Password:
                </label>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                    <input type="text" id="clientPassword" readonly style="font-family: 'Courier New', monospace; font-weight: 700; font-size: 18px; letter-spacing: 3px; color: #92400e; background: white; border: 2px solid #f59e0b; padding: 10px 16px; border-radius: 8px; flex: 1; min-width: 200px; text-align: center; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                    <button onclick="copyPassword(event)" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); transition: all 0.3s ease;" title="Copy password" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.2)'">üìã Copy</button>
                    <button onclick="regeneratePassword()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); transition: all 0.3s ease;" title="Generate new password" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.2)'">üîÑ New</button>
                </div>
                <div style="font-size: 11px; color: #92400e; margin-top: 4px; font-style: italic; line-height: 1.4;">
                    ‚ö†Ô∏è <strong>Important:</strong> This password is unique to this quote. Keep it secure for future reference.
                </div>
            </div>
        </div>

        <!-- TAB NAVIGATION -->
        <div class="tab-navigation" style="background: white; border-bottom: 3px solid #e2e8f0; padding: 0; margin: 0;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; gap: 0;">
                <button class="tab-button active" onclick="showTab('quote')" id="tab-quote" style="flex: 1; padding: 20px; background: transparent; border: none; border-bottom: 3px solid #2563eb; color: #2563eb; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s;">
                    üìã Quote & Information
                </button>
                <button class="tab-button" onclick="showTab('forms')" id="tab-forms" style="flex: 1; padding: 20px; background: transparent; border: none; border-bottom: 3px solid transparent; color: #64748b; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.3s;">
                    üìÑ IRS Forms
                </button>
            </div>
        </div>

        <!-- CONTENT - QUOTE TAB -->
        <div class="content" id="tab-content-quote">
            
            <!-- SECCI√ìN 1: INFORMACI√ìN DEL CLIENTE -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">1</div>
                    <span>CLIENT INFORMATION</span>
                </div>

                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Important:</strong> Complete all fields marked with an asterisk (*). This information is required by the IRS and the Maryland Department of Taxation.
                </div>

                <div class="dual-client">
                    <!-- CLIENTE 1 / TAXPAYER -->
                    <div class="client-column">
                        <h4>üë§ TAXPAYER (Primary Client)</h4>
                        
                        <div class="form-group">
                            <label>Legal First Name <span class="required">*</span></label>
                            <input type="text" id="firstName1" placeholder="As shown on passport">
                        </div>
                        
                        <div class="form-group">
                            <label>Middle Name (Segundo Nombre)</label>
                            <input type="text" id="middleName1" placeholder="Optional">
                        </div>
                        
                        <div class="form-group">
                            <label>Last Name <span class="required">*</span></label>
                            <input type="text" id="lastName1" placeholder="As shown on passport">
                        </div>
                        
                        <div class="form-group">
                            <label>Date of Birth <span class="required">*</span>
                                <span class="hint">MM/DD/YYYY - Required by IRS</span>
                            </label>
                            <input type="date" id="dob1">
                        </div>
                        
                        <div class="form-group">
                            <label>Country of Citizenship <span class="required">*</span></label>
                            <input type="text" id="citizenship1" placeholder="e.g., Mexico, El Salvador">
                        </div>
                        
                        <div class="form-group">
                            <label>Country of Birth <span class="required">*</span></label>
                            <input type="text" id="birthCountry1" placeholder="Birth country">
                        </div>
                        
                        <div class="form-group">
                            <label>Passport Number <span class="required">*</span>
                                <span class="hint">Required for ITIN application</span>
                            </label>
                            <input type="text" id="passport1" placeholder="e.g., G12345678">
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Passport Issue Date</label>
                                <input type="date" id="passportIssue1">
                            </div>
                            <div class="form-group">
                                <label>Passport Exp. Date <span class="required">*</span></label>
                                <input type="date" id="passportExp1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>SSN / ITIN (if available)</label>
                            <input type="text" id="ssn1" placeholder="XXX-XX-XXXX" maxlength="11">
                        </div>
                        
                        <div class="form-group">
                            <label>U.S. Visa Type (if applicable)</label>
                            <select id="visaType1">
                                <option value="">Select visa type</option>
                                <option value="none">No visa</option>
                                <option value="b1b2">B1/B2 Tourist</option>
                                <option value="h1b">H1B Work</option>
                                <option value="f1">F1 Student</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Foreign Tax ID Number (if applicable)
                                <span class="hint">RFC (Mexico), CURP, etc.</span>
                            </label>
                            <input type="text" id="foreignTaxId1" placeholder="e.g., RFC">
                        </div>
                        
                        <div class="form-group">
                            <label>Occupation (Ocupaci√≥n)</label>
                            <input type="text" id="occupation1" placeholder="e.g., Business Owner">
                        </div>
                    </div>

                    <!-- CLIENTE 2 / SPOUSE -->
                    <div class="client-column">
                        <h4>üë• SPOUSE</h4>
                        
                        <div class="form-group">
                            <label>Legal First Name (Nombre Legal)</label>
                            <input type="text" id="firstName2" placeholder="As shown on passport">
                        </div>
                        
                        <div class="form-group">
                            <label>Middle Name (Segundo Nombre)</label>
                            <input type="text" id="middleName2" placeholder="Optional">
                        </div>
                        
                        <div class="form-group">
                            <label>Last Name (Apellido)</label>
                            <input type="text" id="lastName2" placeholder="As shown on passport">
                        </div>
                        
                        <div class="form-group">
                            <label>Date of Birth (Fecha de Nacimiento)
                                <span class="hint">MM/DD/YYYY - Required by IRS</span>
                            </label>
                            <input type="date" id="dob2">
                        </div>
                        
                        <div class="form-group">
                            <label>Country of Citizenship (Pa√≠s de Ciudadan√≠a)</label>
                            <input type="text" id="citizenship2" placeholder="e.g., Mexico, El Salvador">
                        </div>
                        
                        <div class="form-group">
                            <label>Country of Birth (Pa√≠s de Nacimiento)</label>
                            <input type="text" id="birthCountry2" placeholder="Birth country">
                        </div>
                        
                        <div class="form-group">
                            <label>Passport Number (N√∫mero de Pasaporte)
                                <span class="hint">Required for ITIN application</span>
                            </label>
                            <input type="text" id="passport2" placeholder="e.g., G12345678">
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Passport Issue Date</label>
                                <input type="date" id="passportIssue2">
                            </div>
                            <div class="form-group">
                                <label>Passport Exp. Date</label>
                                <input type="date" id="passportExp2">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>SSN / ITIN (if available)</label>
                            <input type="text" id="ssn2" placeholder="XXX-XX-XXXX" maxlength="11">
                        </div>
                        
                        <div class="form-group">
                            <label>U.S. Visa Type (if applicable)</label>
                            <select id="visaType2">
                                <option value="">Select visa type</option>
                                <option value="none">No visa</option>
                                <option value="b1b2">B1/B2 Tourist</option>
                                <option value="h1b">H1B Work</option>
                                <option value="f1">F1 Student</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Foreign Tax ID Number (if applicable)
                                <span class="hint">RFC (Mexico), CURP, etc.</span>
                            </label>
                            <input type="text" id="foreignTaxId2" placeholder="e.g., RFC">
                        </div>
                        
                        <div class="form-group">
                            <label>Occupation (Ocupaci√≥n)</label>
                            <input type="text" id="occupation2" placeholder="e.g., Business Owner">
                        </div>
                    </div>
                </div>

                <!-- INFORMACI√ìN DE CONTACTO -->
                <div class="subsection">
                    <div class="subsection-title">üìç U.S. Mailing Address / Direcci√≥n Postal en EE.UU.</div>
                    
                    <div class="form-grid">
                        <div class="form-group form-grid-full">
                            <label>Street Address (N√∫mero y Calle) <span class="required">*</span>
                                <span class="hint">Required by IRS for correspondence</span>
                            </label>
                            <input type="text" id="street" placeholder="e.g., 123 Main Street">
                        </div>
                        
                        <div class="form-group">
                            <label>Apartment / Unit #</label>
                            <input type="text" id="apt" placeholder="Apt, Suite, Unit">
                        </div>
                        
                        <div class="form-group">
                            <label>City (Ciudad) <span class="required">*</span></label>
                            <input type="text" id="city" placeholder="e.g., Baltimore">
                        </div>
                        
                        <div class="form-group">
                            <label>State (Estado) <span class="required">*</span></label>
                            <select id="state">
                                <option value="">Select State</option>
                                <option value="MD" selected>Maryland (MD)</option>
                                <option value="VA">Virginia (VA)</option>
                                <option value="DC">District of Columbia (DC)</option>
                                <option value="PA">Pennsylvania (PA)</option>
                                <option value="DE">Delaware (DE)</option>
                                <option value="other">Other State</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>ZIP Code <span class="required">*</span>
                                <span class="hint">5-digit ZIP code</span>
                            </label>
                            <input type="text" id="zip" placeholder="e.g., 21201" maxlength="5">
                        </div>
                    </div>
                    
                    <div class="form-grid-3">
                        <div class="form-group">
                            <label>Primary Phone (Tel√©fono Principal) <span class="required">*</span></label>
                            <input type="tel" id="phone" placeholder="(XXX) XXX-XXXX">
                        </div>
                        
                        <div class="form-group">
                            <label>Alternative Phone</label>
                            <input type="tel" id="altPhone" placeholder="(XXX) XXX-XXXX">
                        </div>
                        
                        <div class="form-group">
                            <label>Email Address <span class="required">*</span>
                                <span class="hint">For IRS and bank correspondence</span>
                            </label>
                            <input type="email" id="email" placeholder="your@email.com">
                        </div>
                    </div>
                </div>

                <!-- ESTADO CIVIL -->
                <div class="subsection">
                    <div class="subsection-title">üíë Marital Status & Filing Information</div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Marital Status (Estado Civil) <span class="required">*</span></label>
                            <select id="maritalStatus" onchange="calcularTotales()">
                                <option value="">Select status</option>
                                <option value="married">Married (Casado/a)</option>
                                <option value="single">Single (Soltero/a)</option>
                                <option value="divorced">Divorced (Divorciado/a)</option>
                                <option value="widowed">Widowed (Viudo/a)</option>
                                <option value="separated">Separated (Separado/a)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Date of Marriage (if applicable)</label>
                            <input type="date" id="marriageDate">
                        </div>
                        
                        <div class="form-group">
                            <label>Number of Dependents (Dependientes)</label>
                            <input type="number" id="dependents" value="0" min="0" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Number of Persons for Services</label>
                            <select id="numPersonas" onchange="calcularTotales()">
                                <option value="1">1 Person</option>
                                <option value="2" selected>2 Persons (Couple/Pareja)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 2: INFORMACI√ìN DE LA LLC -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">2</div>
                    <span>LLC INFORMATION</span>
                </div>

                <div class="subsection">
                    <div class="subsection-title">üè¢ Business Entity Information</div>
                    
                    <div class="form-grid">
                        <div class="form-group form-grid-full">
                            <label>Legal LLC Name <span class="required">*</span>
                                <span class="hint">Exact name as registered with Maryland SDAT</span>
                            </label>
                            <input type="text" id="llcName" placeholder="e.g., ABC SERVICES LLC">
                        </div>
                        
                        <div class="form-group">
                            <label>Maryland Department ID
                                <span class="hint">SDAT Department ID number</span>
                            </label>
                            <input type="text" id="mdDeptId" placeholder="e.g., D12345678">
                        </div>
                        
                        <div class="form-group">
                            <label>EIN (Employer ID Number) <span class="required">*</span>
                                <span class="hint">XX-XXXXXXX format</span>
                            </label>
                            <input type="text" id="ein" placeholder="XX-XXXXXXX" maxlength="10">
                        </div>
                        
                        <div class="form-group">
                            <label>LLC Formation Date <span class="required">*</span></label>
                            <input type="date" id="llcFormationDate">
                        </div>
                        
                        <div class="form-group">
                            <label>State of Formation <span class="required">*</span></label>
                            <select id="llcState">
                                <option value="MD" selected>Maryland</option>
                                <option value="DE">Delaware</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Business Type / Industry</label>
                            <input type="text" id="businessType" placeholder="e.g., Construction, Cleaning, Retail">
                        </div>
                        
                        <div class="form-group">
                            <label>NAICS Code (if known)
                                <span class="hint">Industry classification code</span>
                            </label>
                            <input type="text" id="naicsCode" placeholder="e.g., 238990">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>LLC Business Address (if different from mailing)</label>
                        <input type="text" id="llcAddress" placeholder="Business physical address">
                    </div>
                    
                    <div class="form-group">
                        <label>Members / Owners <span class="required">*</span>
                            <span class="hint">List all LLC members and ownership %</span>
                        </label>
                        <textarea id="llcMembers" rows="3" placeholder="e.g., John Doe - 50%, Jane Doe - 50%"></textarea>
                    </div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="singleMemberLLC">
                            <label for="singleMemberLLC">Single-Member LLC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="multiMemberLLC" checked>
                            <label for="multiMemberLLC">Multi-Member LLC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="needBankAccount">
                            <label for="needBankAccount">Necesita apertura de cuenta bancaria empresarial</label>
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <div class="subsection-title">üí∞ Business Financial Information (Tax Year 2024)</div>
                    
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Important:</strong> Provide accurate information for Schedule C preparation and tax calculation.
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Gross Receipts / Sales (Ingresos Brutos) <span class="required">*</span>
                                <span class="hint">Form 1099-NEC, 1099-K, or cash receipts</span>
                            </label>
                            <input type="number" id="grossReceipts" value="350000" step="0.01" placeholder="$0.00">
                        </div>
                        
                        <div class="form-group">
                            <label>Total Business Expenses (Gastos Totales) <span class="required">*</span>
                                <span class="hint">All deductible business expenses</span>
                            </label>
                            <input type="number" id="totalExpenses" value="380000" step="0.01" placeholder="$0.00" onchange="calcularNetIncome()">
                        </div>
                        
                        <div class="form-group">
                            <label>Net Profit/Loss (Ganancia/P√©rdida Neta)
                                <span class="hint">Automatically calculated</span>
                            </label>
                            <input type="text" id="netIncome" readonly style="background: #f8f9fa; font-weight: bold;" value="-$30,000.00">
                        </div>
                        
                        <div class="form-group">
                            <label>Number of 1099 Forms Received</label>
                            <input type="number" id="num1099" value="0" min="0" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="hasCashTransactions">
                            <label for="hasCashTransactions">Received cash payments (Recibi√≥ pagos en efectivo)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="hasEmployees">
                            <label for="hasEmployees">Has employees (Tiene empleados)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="hasInventory">
                            <label for="hasInventory">Maintains inventory (Mantiene inventario)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="homeOffice">
                            <label for="homeOffice">Uses home office (Usa oficina en casa)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 3: SERVICIOS PROFESIONALES -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">3</div>
                    <span>PROFESSIONAL SERVICES</span>
                </div>

                <div class="alert alert-success">
                    <strong>‚úÖ Complete Package:</strong> The following services include complete document preparation for the IRS, State of Maryland, and banking entities.
                </div>

                <!-- SERVICIO 1: ITIN -->
                <div class="service-card">
                    <div class="service-header">
                        <div class="service-title">
                            <h3>TAX IDENTITY MANAGEMENT AND STRUCTURAL FILINGS</h3>
                            <div class="subtitle">ITIN Application & Maryland State Certification</div>
                        </div>
                        <div class="price-box">
                            <div class="price-label">Price per person</div>
                            <input type="number" class="price-input" id="precioITIN" value="248.00" step="0.01" onchange="calcularTotales()">
                        </div>
                    </div>
                    
                    <div class="service-description">
                        <p><strong>This service includes comprehensive preparation of your file for obtaining your tax identification numbers and administrative compliance for your business:</strong></p>
                        
                        <ul>
                            <li><strong>Maryland State Management (SDAT Certification Request):</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Preparation of formal letters to the Maryland Department of Assessments and Taxation (SDAT)</li>
                                    <li>Request for Certificate of Status certifying that both are active members of your LLC</li>
                                    <li>Good Standing certification for the business</li>
                                </ul>
                            </li>
                            
                            <li><strong>Complete ITIN Application Package to the IRS:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Preparation of Form W-7 (Application for IRS Individual Taxpayer Identification Number)</li>
                                    <li>Cover letters and justification addressed to the IRS in Austin, TX</li>
                                    <li>Organization of the file with mandatory attachments: Passports, LLC records, and state certifications</li>
                                    <li>Document verification according to IRS standards</li>
                                </ul>
                            </li>
                            
                            <li><strong>Banking Management (Bank Account Opening Support):</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Preparation of formal letter for the bank officer</li>
                                    <li>Supporting documentation explaining the ITIN status in process</li>
                                    <li>Regulatory compliance package</li>
                                    <li>Guide to documents required by the banking entity</li>
                                </ul>
                            </li>
                            
                            <li><strong>Step-by-Step Shipping Guide:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Detailed instructions for initial shipment to Maryland SDAT</li>
                                    <li>Final package assembly for the IRS with tracking</li>
                                    <li>Presentation of supporting documents to the bank to demonstrate legal compliance</li>
                                    <li>Follow-up and estimated response timeline</li>
                                </ul>
                            </li>
                        </ul>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><strong>Number of people:</strong> <span id="displayNumPersonas">2</span></span>
                                <span style="font-size: 18px; font-weight: 700; color: #1e3c72;">SUBTOTAL: $<span id="totalITIN">310.00</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SERVICIO 2: TAX PREPARATION -->
                <div class="service-card">
                    <div class="service-header">
                        <div class="service-title">
                            <h3>ANNUAL TAX RETURN PREPARATION</h3>
                            <div class="subtitle">Form 1040 - U.S. Individual Income Tax Return (Tax Year 2024)</div>
                        </div>
                    </div>
                    
                    <div class="service-description">
                        <p><strong>Select the filing status according to your convenience and tax situation:</strong></p>
                        
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" name="filingStatus" id="optionJoint" value="joint" checked onchange="calcularTotales()">
                                <div class="radio-option-content">
                                    <div class="radio-option-title">
                                        OPTION A: Married Filing Jointly
                                        <span class="recommended-badge">RECOMMENDED</span>
                                    </div>
                                    <div class="radio-option-desc">
                                        Single family return. Allows you to take advantage of the widest tax brackets (see benefits table). 
                                        Standard deduction: $29,200. Optimizes tax payment and maximizes available credits.
                                    </div>
                                </div>
                                <input type="number" class="price-input" id="precioJoint" value="370.00" step="0.01" onchange="calcularTotales()">
                            </div>
                            
                            <div class="radio-option">
                                <input type="radio" name="filingStatus" id="optionSeparate" value="separate" onchange="calcularTotales()">
                                <div class="radio-option-content">
                                    <div class="radio-option-title">
                                        OPTION B: Married Filing Separately
                                    </div>
                                    <div class="radio-option-desc">
                                        Two independent returns. Standard deduction: $14,600 per person. 
                                        Total for 2 people: <strong>$<span id="totalSeparate">480.00</span></strong>
                                    </div>
                                </div>
                                <input type="number" class="price-input" id="precioSeparate" value="240.00" step="0.01" onchange="calcularTotales()">
                            </div>
                            
                            <div class="radio-option">
                                <input type="radio" name="filingStatus" id="optionSingle" value="single" onchange="calcularTotales()">
                                <div class="radio-option-content">
                                    <div class="radio-option-title">
                                        OPTION C: Single
                                    </div>
                                    <div class="radio-option-desc">
                                        Individual return. Standard deduction: $14,600. 
                                        For single taxpayers or one person only.
                                    </div>
                                </div>
                                <input type="number" class="price-input" id="precioSingle" value="120.00" step="0.01" onchange="calcularTotales()">
                            </div>
                        </div>
                        
                        <div style="background: #e8f4f8; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid #0c5460;">
                            <strong>üìã Includes:</strong>
                            <ul style="margin-top: 10px; margin-bottom: 0;">
                                <li>Complete preparation of Form 1040</li>
                                <li>Calculation of standard or itemized deductions</li>
                                <li>Application of available tax credits (Child Tax Credit, Earned Income Credit, etc.)</li>
                                <li>Review of eligibility for additional credits</li>
                                <li>E-filing with the IRS or preparation for postal submission</li>
                                <li>Complete copy of the return for your records</li>
                            </ul>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><strong>Selected option:</strong> <span id="displayFilingStatus">Married Filing Jointly</span></span>
                                <span style="font-size: 18px; font-weight: 700; color: #1e3c72;">SUBTOTAL: $<span id="subtotalTax">370.00</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SERVICIO 3: SCHEDULE C -->
                <div class="service-card">
                    <div class="service-header">
                        <div class="service-title">
                            <h3>BUSINESS ACTIVITY REPORT (SCHEDULE C)</h3>
                            <div class="subtitle">Schedule C - Profit or Loss from Business (Sole Proprietorship)</div>
                        </div>
                        <div class="price-box">
                            <div class="price-label">Service price</div>
                            <input type="number" class="price-input" id="precioScheduleC" value="380.00" step="0.01" onchange="calcularTotales()">
                        </div>
                    </div>
                    
                    <div class="service-description">
                        <p><strong>Essential service due to the volume of business transactions of your LLC.</strong> This service is critical for tax compliance and optimization of your tax situation.</p>
                        
                        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 15px 0; border-radius: 4px;">
                            <strong>‚ö†Ô∏è Important Note:</strong> The client must provide monthly detail per person if we need to create the accounting based on their account statements. <strong>An additional $40.00 per month</strong> is charged for this additional accounting service.
                        </div>
                        
                        <ul>
                            <li><strong>Schedule C Preparation (Form 1040):</strong> Detailed statement of your business income and expenses</li>
                            <li><strong>Forms 1099-NEC/1099-K Processing:</strong> Reconciliation of all income reports received</li>
                            <li><strong>Complete Breakdown of Deductible Expenses:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Advertising & Marketing</li>
                                    <li>Vehicle expenses (mileage or actual)</li>
                                    <li>Supplies & Materials</li>
                                    <li>Contract Labor</li>
                                    <li>Insurance (business)</li>
                                    <li>Legal & Professional fees</li>
                                    <li>Office expenses</li>
                                    <li>Rent or lease</li>
                                    <li>Repairs & Maintenance</li>
                                    <li>Utilities</li>
                                    <li>Travel & Meals (50% deductible)</li>
                                    <li>Home Office deduction (if applicable)</li>
                                    <li>Depreciation of assets</li>
                                </ul>
                            </li>
                            <li><strong>Net Operating Loss (NOL) Calculation:</strong> When expenses exceed income</li>
                            <li><strong>Tax Shield Generation:</strong> Loss that can be applied to future years to reduce taxes</li>
                            <li><strong>Self-Employment Tax Calculation:</strong> Social Security and Medicare taxes</li>
                        </ul>
                        
                        <div class="business-inputs">
                            <div class="form-group">
                                <label>üí∞ Gross Receipts:</label>
                                <input type="number" id="schedCIncome" value="350000" step="0.01" onchange="calcularNetIncome()" style="font-weight: 600; color: #28a745;">
                            </div>
                            <div class="form-group">
                                <label>üí∏ Total Expenses:</label>
                                <input type="number" id="schedCExpenses" value="380000" step="0.01" onchange="calcularNetIncome()" style="font-weight: 600; color: #dc3545;">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>üìä Net Profit/Loss:</label>
                                <input type="text" id="schedCNet" readonly style="background: #f8f9fa; font-weight: 700; font-size: 16px; color: #1e3c72;">
                            </div>
                        </div>
                        
                        <div class="alert alert-success" style="margin-top: 15px;">
                            <strong>üí° Tax Benefit:</strong> With a net loss of <strong>$<span id="displayLoss">30,000</span></strong>, 
                            you will NOT pay federal income taxes this year, and you can apply this loss (NOL Carryforward) 
                            to reduce taxes in future years when you have profits.
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 6px; margin-top: 15px; border: 1px solid #dee2e6;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><strong>Schedule C Preparation</strong></span>
                                <span style="font-size: 18px; font-weight: 700; color: #1e3c72;">SUBTOTAL: $<span id="displayScheduleC">380.00</span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 4: TABLA DE UMBRALES FISCALES -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">4</div>
                    <span>2024 TAX BRACKETS</span>
                </div>

                <div class="alert alert-info">
                    <strong>üìä Comparative Analysis:</strong> Filing as a couple (Married Filing Jointly) allows you to stay in the lowest tax percentages on a larger amount of income, maximizing your tax savings.
                </div>

                <table class="tax-table">
                    <thead>
                        <tr>
                            <th>Tax Rate</th>
                            <th>Single / Married Filing Separately</th>
                            <th>Married Filing Jointly</th>
                            <th>Tax Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="tax-rate">10%</span></td>
                            <td>$0 ‚Äì $11,600</td>
                            <td style="background: #d4edda; font-weight: 600;">$0 ‚Äì $23,200</td>
                            <td style="color: #28a745; font-weight: 600;">+$11,600</td>
                        </tr>
                        <tr>
                            <td><span class="tax-rate">12%</span></td>
                            <td>$11,601 ‚Äì $47,150</td>
                            <td style="background: #d4edda; font-weight: 600;">$23,201 ‚Äì $94,300</td>
                            <td style="color: #28a745; font-weight: 600;">+$47,150</td>
                        </tr>
                        <tr>
                            <td><span class="tax-rate">22%</span></td>
                            <td>$47,151 ‚Äì $100,525</td>
                            <td style="background: #d4edda; font-weight: 600;">$94,301 ‚Äì $201,050</td>
                            <td style="color: #28a745; font-weight: 600;">+$100,525</td>
                        </tr>
                        <tr>
                            <td><span class="tax-rate">24%</span></td>
                            <td>$100,526 ‚Äì $191,950</td>
                            <td style="background: #d4edda; font-weight: 600;">$201,051 ‚Äì $383,900</td>
                            <td style="color: #28a745; font-weight: 600;">+$191,950</td>
                        </tr>
                        <tr>
                            <td><span class="tax-rate">32%</span></td>
                            <td>$191,951 ‚Äì $243,725</td>
                            <td style="background: #d4edda; font-weight: 600;">$383,901 ‚Äì $487,450</td>
                            <td style="color: #28a745; font-weight: 600;">+$243,725</td>
                        </tr>
                    </tbody>
                </table>

                <div class="subsection">
                    <div class="subsection-title">üí∞ Standard Deductions for 2024</div>
                    <table class="tax-table">
                        <thead>
                            <tr>
                                <th>Filing Status</th>
                                <th>Standard Deduction</th>
                                <th>Additional (Age 65+)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Single</td>
                                <td>$14,600</td>
                                <td>+$1,950</td>
                            </tr>
                            <tr style="background: #d4edda;">
                                <td><strong>Married Filing Jointly</strong></td>
                                <td><strong>$29,200</strong></td>
                                <td>+$1,550 per person</td>
                            </tr>
                            <tr>
                                <td>Married Filing Separately</td>
                                <td>$14,600</td>
                                <td>+$1,550</td>
                            </tr>
                            <tr>
                                <td>Head of Household</td>
                                <td>$21,900</td>
                                <td>+$1,950</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SECCI√ìN 5: RESUMEN FINANCIERO -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">5</div>
                    <span>RESUMEN DE INVERSI√ìN / INVESTMENT SUMMARY</span>
                </div>

                <table class="summary-table" id="summaryTable">
                    <thead>
                        <tr>
                            <th>Service Description<br>Descripci√≥n del Servicio</th>
                            <th>Details<br>Detalles</th>
                            <th>Amount<br>Monto</th>
                        </tr>
                    </thead>
                    <tbody id="summaryTableBody">
                        <!-- Se llenar√° din√°micamente -->
                    </tbody>
                </table>

                <div class="terms-section">
                    <h4>üìã TERMS & CONDITIONS</h4>
                    <ul>
                        <li><strong>Payment Terms:</strong> 80% advance payment required to start services. The remaining 20% at the time of form submission.</li>
                        <li><strong>Payment Methods:</strong> Cash, Check, Zelle, Wire Transfer, Credit/Debit Card (processing fee may apply).</li>
                        <li><strong>Delivery Time:</strong> 10 business days once signed information is received.</li>
                        <li><strong>Required Documents:</strong> Valid passports, LLC Articles of Organization, Operating Agreement, EIN Letter, financial statements or accounting records for the fiscal year.</li>
                        <li><strong>IRS Processing Time:</strong> ITIN generally takes 7-11 weeks from when the IRS receives the application.</li>
                        <li><strong>Quote Validity:</strong> This offer is valid for 5 days from the issue date.</li>
                        <li><strong>Confidentiality:</strong> All information provided will be treated with strict confidentiality according to IRS Circular 230.</li>
                        <li><strong>Professional Guarantee:</strong> If the IRS rejects the ITIN application due to an error in our preparation, we will redo the process at no additional cost.</li>
                        <li><strong>Not included:</strong> Certified document translation, apostilles, IRS or State fees, certified shipping expenses.</li>
                    </ul>
                </div>

                <div class="subsection">
                    <div class="subsection-title">üí¨ Additional Notes</div>
                    <div class="form-group">
                        <label>Special Instructions or Comments:</label>
                        <textarea id="additionalNotes" rows="4" placeholder="Enter any special requirements, deadlines, or additional information..."></textarea>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN 6: FIRMAS -->
            <div class="section">
                <div class="section-header">
                    <div class="section-number">6</div>
                    <span>ACCEPTANCE & SIGNATURES</span>
                </div>

                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è Client Authorization:</strong> By signing this document, I authorize <strong>SECURE ASSETS HOLDING LLC</strong> to prepare and submit the mentioned documents to the IRS, the State of Maryland, and other entities as necessary. I confirm that the information provided is true and complete.
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <div class="signature-name" id="signatureName1">Taxpayer</div>
                        <div class="signature-label">Signature</div>
                        <div style="margin-top: 20px;">
                            <strong>Date:</strong>
                            <input type="date" id="clientSignDate1" style="border: none; border-bottom: 1px solid #999; padding: 5px; margin-left: 10px;">
                        </div>
                    </div>

                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <div class="signature-name" id="signatureName2">Spouse (if applicable)</div>
                        <div class="signature-label">Signature</div>
                        <div style="margin-top: 20px;">
                            <strong>Date:</strong>
                            <input type="date" id="clientSignDate2" style="border: none; border-bottom: 1px solid #999; padding: 5px; margin-left: 10px;">
                        </div>
                    </div>
                </div>

                <div class="signature-section" style="margin-top: 40px; border-top: 2px solid #dee2e6; padding-top: 30px;">
                    <div class="signature-box">
                        <div class="signature-line" id="preparerSignatureLine" style="position: relative; min-height: 60px;">
                            <canvas id="preparerSignatureCanvas" width="300" height="80" style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); border: 1px dashed #ccc; border-radius: 4px; cursor: crosshair;"></canvas>
                        </div>
                        <div class="signature-name">JANINE TERAN</div>
                        <div class="signature-label">Tax Preparer - SECURE ASSETS HOLDING LLC</div>
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            <strong style="color: #1e3c72;">PTIN: P03429037</strong> | Status: <span style="color: #28a745;">Active</span><br>
                            Valid For Calendar Year(s): <strong>2025, 2026</strong><br>
                            Date: <input type="date" id="preparerSignDate" style="border: none; border-bottom: 1px solid #999; padding: 5px;">
                        </div>
                        <button onclick="clearSignature('preparer')" class="btn" style="margin-top: 10px; padding: 5px 15px; font-size: 12px; background: #6c757d; color: white;">üóëÔ∏è Clear Signature</button>
                    </div>

                    <div class="signature-box">
                        <div style="text-align: left; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 1px solid #dee2e6;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 18px;">SAH</div>
                                <div>
                                    <strong style="color: #1e3c72; font-size: 14px;">SECURE ASSETS HOLDING LLC</strong>
                                </div>
                            </div>
                            <div style="font-size: 12px; color: #555; line-height: 1.8;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="color: #28a745;">‚úì</span> <strong>PTIN:</strong> P03429037
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="color: #28a745;">‚úì</span> <strong>Status:</strong> Active
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="color: #28a745;">‚úì</span> <strong>Valid For Calendar Year(s):</strong> 2025, 2026
                                </div>
                                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                                    <div style="margin-bottom: 6px;"><strong>State:</strong> <span style="color: #666;">Federal (all states)</span></div>
                                    <div style="margin-bottom: 6px;"><strong>Phone:</strong> <span style="color: #666;">347-547-5640</span></div>
                                    <div><strong>Email:</strong> <span style="color: #666;">janinehubner@secureassetshldg.com</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- SECCI√ìN DE FIRMA DIGITAL -->
                <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #e8f4f8 0%, #d1ecf1 100%); border-radius: 12px; border: 2px solid #0c5460;">
                    <h4 style="color: #0c5460; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        ‚úçÔ∏è DIGITAL SIGNATURE
                    </h4>
                    <p style="font-size: 13px; color: #555; margin-bottom: 20px;">
                        This document can be digitally signed. Digital signatures have the same legal validity as handwritten signatures according to the ESIGN Act (Electronic Signatures in Global and National Commerce Act).
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;" id="signatureGrid">
                        <div style="background: white; padding: 25px; border-radius: 12px; border: 1px solid #dee2e6; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
                            <label style="font-weight: 700; color: #1e3c72; font-size: 15px; display: block; margin-bottom: 15px;">
                                ‚úçÔ∏è Client Digital Signature
                                <span id="deviceInfo" style="font-size: 11px; color: #666; font-weight: 400; margin-left: 8px; display: block; margin-top: 4px;"></span>
                            </label>
                            
                            <!-- Controles de Firma -->
                            <div class="signature-controls" style="display: flex; gap: 12px; margin-bottom: 15px; flex-wrap: wrap; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 8px 12px; border-radius: 8px;">
                                    <label style="font-size: 12px; color: #666; font-weight: 600;">Thickness:</label>
                                    <input type="range" id="signatureThickness" min="1" max="5" value="2.5" step="0.5" style="width: 80px;" oninput="updateSignatureStyle()">
                                    <span id="thicknessValue" style="font-size: 11px; color: #1e3c72; font-weight: 600; min-width: 30px;">2.5px</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 8px 12px; border-radius: 8px;">
                                    <label style="font-size: 12px; color: #666; font-weight: 600;">Color:</label>
                                    <input type="color" id="signatureColor" value="#1e3c72" style="width: 50px; height: 30px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;" onchange="updateSignatureStyle()">
                                </div>
                                <button onclick="clearSignature('clientDigital')" class="btn" style="padding: 8px 16px; font-size: 12px; background: #dc3545; color: white; border-radius: 8px; border: none; cursor: pointer; font-weight: 600;">üóëÔ∏è Clear</button>
                                <label for="signatureImageUpload" style="padding: 8px 16px; font-size: 12px; background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); color: white; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; display: inline-block; box-shadow: 0 2px 6px rgba(111,66,193,0.3);">üì∑ Load Signature</label>
                                <input type="file" id="signatureImageUpload" accept="image/*" style="display: none;" onchange="loadSignatureImage(event)">
                            </div>
                            <div style="font-size: 11px; color: #666; margin-top: -10px; margin-bottom: 10px; font-style: italic;">
                                üí° You can also paste an image with Ctrl+V (or Cmd+V on Mac)
                            </div>
                            
                            <!-- Canvas de Firma Mejorado -->
                            <div style="position: relative; margin: 0 auto; width: 100%; max-width: 500px; background: linear-gradient(135deg, #fafafa 0%, #ffffff 100%); border-radius: 12px; padding: 15px; box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);">
                                <canvas id="clientDigitalSignature" width="500" height="200" style="border: 3px solid #1e3c72; border-radius: 10px; cursor: crosshair; background: white; display: block; width: 100%; height: auto; touch-action: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"></canvas>
                                <div id="signatureHint" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; color: #999; font-size: 14px; text-align: center; opacity: 0.5; transition: opacity 0.3s;">
                                    <div id="hintText" style="font-weight: 500;">Sign here with your mouse</div>
                                    <div style="font-size: 11px; margin-top: 4px; opacity: 0.7;">Drag to sign</div>
                                </div>
                                <div id="signatureStatus" style="margin-top: 12px; text-align: center; font-size: 12px; color: #666; min-height: 18px;">
                                    <span id="signatureStatusText"></span>
                                </div>
                            </div>
                            
                            <!-- Botones de Acci√≥n -->
                            <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center; flex-wrap: wrap;">
                                <button onclick="saveSignature('clientDigital')" class="btn" style="padding: 12px 24px; font-size: 13px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; box-shadow: 0 4px 12px rgba(40,167,69,0.3);">üíæ Save Signature</button>
                                <button onclick="downloadSignature('clientDigital')" class="btn" style="padding: 12px 24px; font-size: 13px; background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; border-radius: 10px; border: none; cursor: pointer; font-weight: 700; box-shadow: 0 4px 12px rgba(0,123,255,0.3);">üì• Download</button>
                            </div>
                            <div style="margin-top: 15px;">
                                <label style="font-size: 12px; color: #666;">Full Name:</label>
                                <input type="text" id="digitalSignerName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px;" placeholder="Enter your full name">
                            </div>
                            <div style="margin-top: 10px;">
                                <label style="font-size: 12px; color: #666;">Date and Time:</label>
                                <input type="text" id="digitalSignTimestamp" readonly style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 4px; background: #f8f9fa;">
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                            <label style="font-weight: 600; color: #1e3c72; font-size: 13px; display: block; margin-bottom: 10px;">Identity Verification:</label>
                            <div style="font-size: 13px; color: #555;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <input type="checkbox" id="confirmIdentity" style="width: 18px; height: 18px;">
                                    <label for="confirmIdentity">I confirm that I am the account holder or authorized representative</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <input type="checkbox" id="confirmAccuracy" style="width: 18px; height: 18px;">
                                    <label for="confirmAccuracy">I confirm that the information is truthful and complete</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                    <input type="checkbox" id="confirmTerms" style="width: 18px; height: 18px;">
                                    <label for="confirmTerms">I accept the terms and conditions of the service</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="confirmAuthorization" style="width: 18px; height: 18px;">
                                    <label for="confirmAuthorization">I authorize submission to the IRS</label>
                                </div>
                            </div>
                            <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 6px; border: 1px solid #28a745;" id="signatureValidation" hidden>
                                <div style="display: flex; align-items: center; gap: 10px; color: #155724; font-weight: 600;">
                                    <span style="font-size: 20px;">‚úÖ</span>
                                    <span>Document Digitally Signed</span>
                                </div>
                                <div style="font-size: 11px; color: #155724; margin-top: 5px;" id="signatureHash"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- END QUOTE TAB CONTENT -->

        <!-- CONTENT - FORMS TAB -->
        <div class="content" id="tab-content-forms" style="display: none;">
            
            <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 25px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #0ea5e9;">
                <h3 style="color: #0c4a6e; margin: 0 0 10px 0; font-size: 22px;">üìÑ IRS Forms Auto-Generator</h3>
                <p style="color: #075985; margin: 0 0 15px 0; font-size: 14px;">Forms will be automatically filled based on the information provided in the Quote section. Click "Auto-Fill Forms" to populate all forms with your client data.</p>
                <button onclick="autoFillAllForms()" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 14px; box-shadow: 0 4px 12px rgba(14,165,233,0.3);">‚ú® Auto-Fill All Forms</button>
            </div>

            <!-- Form W-7: ITIN Application -->
            <div class="form-section" id="form-w7-section">
                <div class="section">
                    <div class="section-header">
                        <div class="section-number">W-7</div>
                        <span>Form W-7: Application for IRS Individual Taxpayer Identification Number</span>
                        <button onclick="printForm('w7')" style="margin-left: auto; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üñ®Ô∏è Print</button>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #1e3c72; margin: 0 0 15px 0;">Instructions</h4>
                        <p style="margin: 0; color: #475569; font-size: 14px;">Complete this form to apply for an ITIN. This form is required for each person who needs an ITIN. Attach a certified copy of your passport or other acceptable documentation.</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>1a. Name (First, Middle, Last) <span class="required">*</span></label>
                            <input type="text" id="w7-name1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>1b. Mailing Address</label>
                            <input type="text" id="w7-address1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>1c. City, State, ZIP Code</label>
                            <input type="text" id="w7-city-state-zip1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>3. Date of Birth (MM/DD/YYYY) <span class="required">*</span></label>
                            <input type="text" id="w7-dob1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>5. Country of Birth <span class="required">*</span></label>
                            <input type="text" id="w7-birth-country1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>6. Country of Citizenship <span class="required">*</span></label>
                            <input type="text" id="w7-citizenship1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>7. Passport Number</label>
                            <input type="text" id="w7-passport1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>9. Passport Expiration Date</label>
                            <input type="text" id="w7-passport-exp1" class="form-w7-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>10. Reason for applying <span class="required">*</span></label>
                            <select id="w7-reason1" class="form-w7-field">
                                <option value="">Select reason</option>
                                <option value="b" selected>b. Nonresident alien filing a U.S. tax return</option>
                                <option value="e">e. Spouse of U.S. citizen/resident alien</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>11. Signature</label>
                            <div style="border: 2px dashed #cbd5e1; padding: 15px; border-radius: 8px; min-height: 60px; background: #f8fafc;">
                                <div id="w7-signature1" style="color: #64748b; font-style: italic;">Signature will appear here</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>12. Date Signed</label>
                            <input type="date" id="w7-sign-date1" class="form-w7-field">
                        </div>
                    </div>

                    <!-- Spouse W-7 Form (if applicable) -->
                    <div id="w7-spouse-section" style="display: none; margin-top: 40px; padding-top: 40px; border-top: 3px solid #e2e8f0;">
                        <h4 style="color: #1e3c72; margin-bottom: 20px;">Spouse ITIN Application (Form W-7)</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>1a. Name (First, Middle, Last) <span class="required">*</span></label>
                                <input type="text" id="w7-name2" class="form-w7-field" readonly>
                            </div>
                            <div class="form-group">
                                <label>3. Date of Birth (MM/DD/YYYY) <span class="required">*</span></label>
                                <input type="text" id="w7-dob2" class="form-w7-field" readonly>
                            </div>
                            <div class="form-group">
                                <label>5. Country of Birth <span class="required">*</span></label>
                                <input type="text" id="w7-birth-country2" class="form-w7-field" readonly>
                            </div>
                            <div class="form-group">
                                <label>6. Country of Citizenship <span class="required">*</span></label>
                                <input type="text" id="w7-citizenship2" class="form-w7-field" readonly>
                            </div>
                            <div class="form-group">
                                <label>7. Passport Number</label>
                                <input type="text" id="w7-passport2" class="form-w7-field" readonly>
                            </div>
                            <div class="form-group">
                                <label>10. Reason for applying <span class="required">*</span></label>
                                <select id="w7-reason2" class="form-w7-field">
                                    <option value="">Select reason</option>
                                    <option value="b">b. Nonresident alien filing a U.S. tax return</option>
                                    <option value="e">e. Spouse of U.S. citizen/resident alien</option>
                                </select>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>11. Signature</label>
                                <div style="border: 2px dashed #cbd5e1; padding: 15px; border-radius: 8px; min-height: 60px; background: #f8fafc;">
                                    <div id="w7-signature2" style="color: #64748b; font-style: italic;">Signature will appear here</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>12. Date Signed</label>
                                <input type="date" id="w7-sign-date2" class="form-w7-field">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form 1040: Tax Return -->
            <div class="form-section" id="form-1040-section">
                <div class="section">
                    <div class="section-header">
                        <div class="section-number">1040</div>
                        <span>Form 1040: U.S. Individual Income Tax Return</span>
                        <button onclick="printForm('1040')" style="margin-left: auto; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üñ®Ô∏è Print</button>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #1e3c72; margin: 0 0 10px 0;">Tax Year 2024</h4>
                        <p style="margin: 0; color: #475569; font-size: 14px;">Complete this form based on the filing status selected in the Quote section.</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Filing Status <span class="required">*</span></label>
                            <input type="text" id="1040-filing-status" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>1a. First name and middle initial</label>
                            <input type="text" id="1040-name1-first" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>1b. Last name</label>
                            <input type="text" id="1040-name1-last" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group" id="1040-spouse-name-group" style="display: none;">
                            <label>1c. Spouse's first name and middle initial</label>
                            <input type="text" id="1040-name2-first" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group" id="1040-spouse-last-group" style="display: none;">
                            <label>1d. Spouse's last name</label>
                            <input type="text" id="1040-name2-last" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>2. Social Security Number (SSN) or ITIN</label>
                            <input type="text" id="1040-ssn1" class="form-1040-field" placeholder="ITIN (if applying)">
                        </div>
                        <div class="form-group" id="1040-spouse-ssn-group" style="display: none;">
                            <label>3. Spouse's SSN or ITIN</label>
                            <input type="text" id="1040-ssn2" class="form-1040-field" placeholder="ITIN (if applying)">
                        </div>
                        <div class="form-group">
                            <label>4. Home Address</label>
                            <input type="text" id="1040-address" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>5. City, State, ZIP Code</label>
                            <input type="text" id="1040-city-state-zip" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>6. Standard Deduction</label>
                            <input type="text" id="1040-standard-deduction" class="form-1040-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>Signature (Taxpayer)</label>
                            <div style="border: 2px dashed #cbd5e1; padding: 15px; border-radius: 8px; min-height: 60px; background: #f8fafc;">
                                <div id="1040-signature1" style="color: #64748b; font-style: italic;">Signature will appear here</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="1040-sign-date1" class="form-1040-field">
                        </div>
                        <div class="form-group" id="1040-spouse-sign-section" style="display: none;">
                            <label>Signature (Spouse - if filing jointly)</label>
                            <div style="border: 2px dashed #cbd5e1; padding: 15px; border-radius: 8px; min-height: 60px; background: #f8fafc;">
                                <div id="1040-signature2" style="color: #64748b; font-style: italic;">Signature will appear here</div>
                            </div>
                        </div>
                        <div class="form-group" id="1040-spouse-date-section" style="display: none;">
                            <label>Date (Spouse)</label>
                            <input type="date" id="1040-sign-date2" class="form-1040-field">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Schedule C: Business Income -->
            <div class="form-section" id="form-schedulec-section">
                <div class="section">
                    <div class="section-header">
                        <div class="section-number">C</div>
                        <span>Schedule C (Form 1040): Profit or Loss from Business</span>
                        <button onclick="printForm('schedulec')" style="margin-left: auto; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üñ®Ô∏è Print</button>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #1e3c72; margin: 0 0 10px 0;">Sole Proprietorship Business Income and Expenses</h4>
                        <p style="margin: 0; color: #475569; font-size: 14px;">This form is used to report income and expenses from a business operated as a sole proprietorship.</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Part I - Income</label>
                        </div>
                        <div class="form-group">
                            <label>1. Gross receipts or sales</label>
                            <input type="text" id="sc-gross-receipts" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Part II - Expenses</label>
                        </div>
                        <div class="form-group">
                            <label>27. Total expenses</label>
                            <input type="text" id="sc-total-expenses" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>28. Tentative profit (Line 1 - Line 27)</label>
                            <input type="text" id="sc-net-income" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>30. Net profit or (loss)</label>
                            <input type="text" id="sc-net-profit-loss" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Business Name</label>
                            <input type="text" id="sc-business-name" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>Business Address</label>
                            <input type="text" id="sc-business-address" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>EIN</label>
                            <input type="text" id="sc-ein" class="form-schedulec-field" readonly>
                        </div>
                        <div class="form-group">
                            <label>Principal business or profession</label>
                            <input type="text" id="sc-business-type" class="form-schedulec-field" readonly>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- END FORMS TAB CONTENT -->

        <!-- BOTONES DE ACCI√ìN -->
        <div class="action-buttons no-print">
            <button class="btn btn-info" onclick="autoFill()">
                <span>üîÑ</span> Auto-fill Demo
            </button>
            <button class="btn btn-warning" onclick="toggleEdit()">
                <span id="editIcon">üîí</span> <span id="editText">Lock Editing</span>
            </button>
            <button class="btn btn-success" onclick="saveData()">
                <span>üíæ</span> Save Data
            </button>
            <button class="btn btn-primary" onclick="printPDF()">
                <span>üìÑ</span> Generate PDF
            </button>
            <button class="btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;" onclick="showClientList()">
                <span>üë•</span> Client Database
            </button>
            <button class="btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;" onclick="showFormsLibrary()">
                <span>üìö</span> Forms Library
            </button>
        </div>

        <!-- FOOTER -->
        <div style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 30px; text-align: center; font-size: 12px;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px;">
                <div style="width: 45px; height: 45px; background: rgba(255,255,255,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">SAH</div>
                <div style="text-align: left;">
                    <p style="font-size: 16px; font-weight: 700; margin: 0;">SECURE ASSETS HOLDING LLC</p>
                    <p style="opacity: 0.8; margin: 0; font-size: 11px;">Professional Tax Preparation Services</p>
                </div>
            </div>
            <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 15px; flex-wrap: wrap;">
                <span>üìã <strong>PTIN:</strong> P03429037</span>
                <span>‚úÖ <strong>Status:</strong> Active</span>
                <span>üìÖ <strong>Valid For Calendar Year(s):</strong> 2025, 2026</span>
            </div>
            <p style="opacity: 0.7; max-width: 600px; margin: 0 auto;">This quote is for informational purposes only and does not constitute legal or financial advice. All tax preparation services are subject to IRS regulations.</p>
            <p style="margin-top: 10px; opacity: 0.6;">¬© 2025 SECURE ASSETS HOLDING LLC. All rights reserved.</p>
        </div>
    </div>

    <!-- Login/Register Modal -->
    <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10001; overflow-y: auto;">
        <div style="max-width: 450px; margin: 50px auto; background: white; border-radius: 16px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #1e3c72; font-size: 28px; margin: 0 0 10px 0;">üîê Admin Login</h2>
                <p style="color: #64748b; font-size: 14px;">Please login with your administrator credentials to access the system.</p>
            </div>
            
            <div id="loginTab" style="display: block;">
                <h3 style="color: #1e3c72; margin-bottom: 20px; font-size: 20px;">Login</h3>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                </div>
                <button onclick="loginUser()" style="width: 100%; margin-top: 20px; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 15px; box-shadow: 0 4px 12px rgba(37,99,235,0.3);">
                    üîì Login
                </button>
                <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; color: #856404; font-size: 12px; line-height: 1.5;">
                        <strong>‚ÑπÔ∏è Note:</strong> Only administrators can login. Clients are created by administrators from the admin panel.
                    </p>
                </div>
            </div>
            
            
            <button onclick="closeLoginModal()" style="position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; display: none;">‚úï</button>
        </div>
    </div>

    <!-- Admin Panel Modal (Admin Only) -->
    <div id="adminPanelModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 1000px; margin: 30px auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">
                <h2 style="color: #1e3c72; font-size: 28px; margin: 0;">‚öôÔ∏è Admin Panel</h2>
                <button onclick="closeAdminPanel()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">‚úï Close</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 20px; border-radius: 12px; border: 2px solid #0ea5e9;">
                    <h3 style="color: #0c4a6e; margin: 0 0 15px 0;">üîë IRS Credentials</h3>
                    <p style="color: #075985; font-size: 14px; margin: 0 0 15px 0;">Configure company credentials for official IRS site access</p>
                    <button onclick="showIRSCredentialsForm()" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Configure Credentials</button>
                </div>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 20px; border-radius: 12px; border: 2px solid #f59e0b;">
                    <h3 style="color: #92400e; margin: 0 0 15px 0;">üß™ Test IRS Access</h3>
                    <p style="color: #92400e; font-size: 14px; margin: 0 0 15px 0;">Test connection to official IRS sites</p>
                    <button onclick="testIRSAccess()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Test Connection</button>
                </div>
                
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 20px; border-radius: 12px; border: 2px solid #10b981;">
                    <h3 style="color: #166534; margin: 0 0 15px 0;">üë• User Management</h3>
                    <p style="color: #166534; font-size: 14px; margin: 0 0 15px 0;">Create and manage client accounts</p>
                    <button onclick="loadUserManagement()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Manage Users</button>
                </div>
            </div>
            
            <div id="adminPanelContent">
                <!-- Admin content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Forms Library Modal -->
    <div id="formsLibraryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 1200px; margin: 30px auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">
                <h2 style="color: #1e3c72; font-size: 28px; margin: 0;">üìö IRS Forms Library</h2>
                <button onclick="closeFormsLibrary()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">‚úï Close</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <select id="formsCategoryFilter" onchange="filterFormsByCategory()" style="padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; flex: 1;">
                        <option value="all">All Categories</option>
                        <option value="Individual">Individual</option>
                        <option value="Schedule">Schedules</option>
                        <option value="Business">Business</option>
                        <option value="Information">Information Returns</option>
                    </select>
                    <input type="text" id="formsSearchInput" placeholder="Search forms..." style="flex: 2; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;" onkeyup="searchForms()">
                    <button onclick="refreshFormsLibrary()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">üîÑ Refresh</button>
                </div>
                <div id="formsLibraryStatus" style="padding: 12px; border-radius: 8px; margin-bottom: 15px; background: #d1fae5; border: 1px solid #10b981;">
                    <strong>Forms Library Status:</strong> <span id="formsLibraryStatusText">Loading...</span>
                </div>
            </div>
            
            <div id="aiRecommendations" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #f59e0b;">
                <h3 style="color: #92400e; margin: 0 0 10px 0; font-size: 18px;">ü§ñ AI Recommendations</h3>
                <button onclick="getAIFormRecommendations()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; margin-bottom: 15px;">‚ú® Get AI Form Recommendations</button>
                <div id="aiRecommendationsContent" style="color: #92400e; font-size: 14px;">
                    Click the button above to get AI-powered form recommendations based on your client data.
                </div>
            </div>
            
            <div id="formsLibraryContainer" style="min-height: 200px;">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                    <div>Loading forms library...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client List Modal -->
    <div id="clientListModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 1200px; margin: 30px auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">
                <h2 style="color: #1e3c72; font-size: 28px; margin: 0;">üë• Client Database</h2>
                <button onclick="closeClientList()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">‚úï Close</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="clientSearchInput" placeholder="Search by name, email, quote number, or password..." style="flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                    <button onclick="searchClients()" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">üîç Search</button>
                    <button onclick="refreshClientList()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">üîÑ Refresh</button>
                </div>
                <div id="dbStatus" style="padding: 12px; border-radius: 8px; margin-bottom: 15px; background: #fff3cd; border: 1px solid #ffc107;">
                    <strong>Database Status:</strong> <span id="dbStatusText">Checking...</span>
                </div>
            </div>
            
            <div id="clientListContainer" style="min-height: 200px;">
                <div style="text-align: center; padding: 40px; color: #64748b;">
                    <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                    <div>Loading clients...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK v9+ Modular (using npm) -->
    <!-- Load Firebase modules and expose to global scope for compatibility -->
    <script type="module">
        // Import Firebase modules
        import { app, db, auth } from './firebase-config.js';
        import databaseService from './database.js';
        import authService from './auth-service.js';
        import irsCredentialsManager from './irs-credentials-manager.js';
        import userManagementService from './user-management.js';
        
        // Make available globally for inline scripts
        window.app = app;
        window.db = db;
        window.auth = auth;
        window.databaseService = databaseService;
        window.authService = authService;
        window.irsCredentialsManager = irsCredentialsManager;
        window.userManagementService = userManagementService;
        
        console.log('‚úÖ Firebase initialized successfully (v9+ Modular SDK)');
    </script>
    
    <!-- IRS Forms Manager (non-module, works standalone) -->
    <script src="forms-downloader.js"></script>
    
    <!-- AI Forms Assistant (non-module, works standalone) -->
    <script src="ai-forms-assistant.js"></script>
    
    <script>
        // Variables globales
        let isEditable = true;
        
        // Cargar logo si existe
        function loadLogo() {
            const logoContainer = document.getElementById('logoContainer');
            const logoImg = document.getElementById('companyLogo');
            
            // Intentar cargar diferentes formatos de logo
            const logoPaths = [
                'assets/logosecure.png',
                'assets/logo.png',
                'assets/logo.svg',
                'assets/logo.jpg',
                'logo.png',
                'logo.svg',
                'logosecure.png'
            ];
            
            let logoLoaded = false;
            logoPaths.forEach(path => {
                if (!logoLoaded) {
                    const img = new Image();
                    img.onload = function() {
                        logoImg.src = path;
                        logoContainer.style.display = 'block';
                        logoLoaded = true;
                    };
                    img.onerror = function() {
                        // Continuar con el siguiente path
                    };
                    img.src = path;
                }
            });
        }
        
        // ========== AUTHENTICATION FUNCTIONS ==========
        
        // Show login modal
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'block';
                // Show login tab by default
                document.getElementById('loginTab').style.display = 'block';
                document.getElementById('registerTab').style.display = 'none';
            }
        }
        
        // Close login modal (only if authenticated)
        function closeLoginModal() {
            // Only allow closing if user is authenticated
            if (window.authService && window.authService.isAuthenticated()) {
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            } else {
                // If not authenticated, prevent closing and show message
                alert('‚ö†Ô∏è Please login or register to access the application.');
            }
        }
        
        // Switch to login tab
        function switchToLogin() {
            document.getElementById('loginTab').style.display = 'block';
            document.getElementById('registerTab').style.display = 'none';
        }
        
        // Login user
        async function loginUser() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è Please enter both email and password.');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ö†Ô∏è Please enter a valid email address.');
                return;
            }
            
            // Show loading state
            const loginBtn = event.target;
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '‚è≥ Logging in...';
            loginBtn.disabled = true;
            
            try {
                if (window.authService) {
                    const result = await window.authService.login(email, password);
                    if (result.success) {
                        // Success - user is now logged in
                        const userRole = result.role || 'client';
                        const welcomeMessage = userRole === 'admin' 
                            ? '‚úÖ Login successful! Welcome back, Administrator.'
                            : '‚úÖ Login successful! Welcome back.';
                        alert(welcomeMessage);
                        closeLoginModal();
                        showMainContent();
                        // Clear form
                        document.getElementById('loginEmail').value = '';
                        document.getElementById('loginPassword').value = '';
                    } else {
                        // Handle specific Firebase errors
                        let errorMessage = 'Invalid credentials. ';
                        if (result.error) {
                            if (result.error.includes('user-not-found')) {
                                errorMessage = '‚ùå No account found with this email. Please contact an administrator.';
                            } else if (result.error.includes('wrong-password')) {
                                errorMessage = '‚ùå Incorrect password. Please try again or use "Forgot Password".';
                            } else if (result.error.includes('invalid-email')) {
                                errorMessage = '‚ùå Invalid email address. Please check and try again.';
                            } else if (result.error.includes('too-many-requests')) {
                                errorMessage = '‚ùå Too many failed attempts. Please try again later.';
                            } else {
                                errorMessage = '‚ùå ' + result.error;
                            }
                        }
                        alert(errorMessage);
                    }
                } else {
                    alert('‚ö†Ô∏è Authentication service not available. Please refresh the page.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('‚ùå Error during login: ' + error.message);
            } finally {
                // Restore button state
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        }
        
        // Check authentication on page load
        function checkAuthOnLoad() {
            // Wait a bit for authService to initialize
            setTimeout(() => {
                if (window.authService) {
                    if (!window.authService.isAuthenticated()) {
                        // Hide main content and show login modal
                        hideMainContent();
                        showLoginModal();
                    } else {
                        // Show main content if authenticated
                        showMainContent();
                    }
                } else {
                    // If authService is not available, show login after a longer delay
                    setTimeout(() => {
                        if (!window.authService || !window.authService.isAuthenticated()) {
                            hideMainContent();
                            showLoginModal();
                        } else {
                            showMainContent();
                        }
                    }, 2000);
                }
            }, 500);
        }
        
        // Hide main content (show only when authenticated)
        function hideMainContent() {
            const container = document.querySelector('.container');
            if (container) {
                container.style.display = 'none';
            }
        }
        
        // Show main content (when authenticated)
        function showMainContent() {
            const container = document.querySelector('.container');
            if (container) {
                container.style.display = 'block';
            }
        }
        
        // Logout user
        async function logoutUser() {
            if (window.authService) {
                await window.authService.logout();
                hideMainContent();
                showLoginModal();
                alert('‚úÖ You have been logged out successfully.');
            }
        }
        
        // ========== END AUTHENTICATION FUNCTIONS ==========
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar logo
            loadLogo();
            
            // Establecer fechas
            const today = new Date();
            document.getElementById('fechaEmision').valueAsDate = today;
            
            const validUntil = new Date();
            validUntil.setDate(validUntil.getDate() + 5);
            document.getElementById('fechaValidez').valueAsDate = validUntil;
            
            // Inicializar contrase√±a del cliente
            initClientPassword();
            
            // Cargar datos guardados (despu√©s de inicializar contrase√±a)
            loadSavedData();
            
            // Calcular totales iniciales
            calcularTotales();
            calcularNetIncome();
            
            // Configurar handler para pegar im√°genes desde portapapeles
            setupPasteHandler();
            
            // Check authentication and show login if needed
            checkAuthOnLoad();
        });
        
        // ========== USER MANAGEMENT FUNCTIONS (Admin Panel) ==========
        
        // Load User Management interface in Admin Panel
        async function loadUserManagement() {
            if (!window.authService || !window.authService.isAdmin()) {
                alert('‚ö†Ô∏è Admin access required.');
                return;
            }

            const adminContent = document.getElementById('adminPanelContent');
            if (!adminContent) return;

            adminContent.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">
                        <h3 style="color: #1e3c72; margin: 0; font-size: 22px;">üë• User Management</h3>
                        <button onclick="showCreateUserForm()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">‚ûï Create New User</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="userSearchInput" placeholder="Search users by email..." style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;" onkeyup="searchUsers()">
                    </div>
                    
                    <div id="userStats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #0ea5e9;">
                            <div style="font-size: 24px; font-weight: 700; color: #0c4a6e;" id="statTotal">-</div>
                            <div style="font-size: 12px; color: #075985; margin-top: 5px;">Total Users</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #ef4444;">
                            <div style="font-size: 24px; font-weight: 700; color: #991b1b;" id="statAdmins">-</div>
                            <div style="font-size: 12px; color: #7f1d1d; margin-top: 5px;">Admins</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #10b981;">
                            <div style="font-size: 24px; font-weight: 700; color: #166534;" id="statClients">-</div>
                            <div style="font-size: 12px; color: #14532d; margin-top: 5px;">Clients</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #f59e0b;">
                            <div style="font-size: 24px; font-weight: 700; color: #92400e;" id="statActive">-</div>
                            <div style="font-size: 12px; color: #78350f; margin-top: 5px;">Active</div>
                        </div>
                    </div>
                    
                    <div id="usersListContainer" style="min-height: 200px;">
                        <div style="text-align: center; padding: 40px; color: #64748b;">
                            <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
                            <div>Loading users...</div>
                        </div>
                    </div>
                </div>
            `;

            await loadUsersList();
            await loadUserStatistics();
        }

        // Load users list
        async function loadUsersList() {
            if (!window.userManagementService) {
                document.getElementById('usersListContainer').innerHTML = '<div style="color: #dc3545; padding: 20px; text-align: center;">User management service not available.</div>';
                return;
            }

            try {
                const users = await window.userManagementService.getAllUsers();
                const container = document.getElementById('usersListContainer');
                
                if (users.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">No users found. Create the first user!</div>';
                    return;
                }

                let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
                html += '<thead><tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Email</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Role</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Status</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Created</th>';
                html += '<th style="padding: 12px; text-align: center; font-weight: 600; color: #1e3c72;">Actions</th>';
                html += '</tr></thead><tbody>';

                users.forEach(user => {
                    const createdAt = user.createdAt?.toDate ? user.createdAt.toDate().toLocaleDateString() : 'N/A';
                    const isActive = user.active !== false;
                    const roleBadge = user.role === 'admin' 
                        ? '<span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">ADMIN</span>'
                        : '<span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">CLIENT</span>';
                    const statusBadge = isActive
                        ? '<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">ACTIVE</span>'
                        : '<span style="background: #64748b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">INACTIVE</span>';

                    html += `<tr style="border-bottom: 1px solid #e2e8f0;">`;
                    html += `<td style="padding: 12px;">${user.email || 'N/A'}</td>`;
                    html += `<td style="padding: 12px;">${roleBadge}</td>`;
                    html += `<td style="padding: 12px;">${statusBadge}</td>`;
                    html += `<td style="padding: 12px; color: #64748b; font-size: 13px;">${createdAt}</td>`;
                    html += `<td style="padding: 12px; text-align: center;">`;
                    html += `<button onclick="editUser('${user.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-right: 5px;">‚úèÔ∏è Edit</button>`;
                    html += `<button onclick="toggleUserStatus('${user.id}', ${!isActive})" style="background: ${isActive ? '#f59e0b' : '#10b981'}; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-right: 5px;">${isActive ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'}</button>`;
                    html += `<button onclick="deleteUserConfirm('${user.id}', '${user.email}')" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">üóëÔ∏è Delete</button>`;
                    html += `</td>`;
                    html += `</tr>`;
                });

                html += '</tbody></table></div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersListContainer').innerHTML = `<div style="color: #dc3545; padding: 20px; text-align: center;">Error loading users: ${error.message}</div>`;
            }
        }

        // Load user statistics
        async function loadUserStatistics() {
            if (!window.userManagementService) return;

            try {
                const stats = await window.userManagementService.getUserStatistics();
                document.getElementById('statTotal').textContent = stats.total;
                document.getElementById('statAdmins').textContent = stats.admins;
                document.getElementById('statClients').textContent = stats.clients;
                document.getElementById('statActive').textContent = stats.active;
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Show create user form
        function showCreateUserForm() {
            const modal = document.createElement('div');
            modal.id = 'createUserModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10002; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <h3 style="color: #1e3c72; margin: 0 0 20px 0; font-size: 22px;">‚ûï Create New User</h3>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="newUserEmail" placeholder="user@example.com" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; margin-top: 5px;">
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Password (min. 6 characters)</label>
                        <input type="password" id="newUserPassword" placeholder="Enter password" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; margin-top: 5px;">
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Role</label>
                        <select id="newUserRole" style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; margin-top: 5px;">
                            <option value="client">Client</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 25px;">
                        <button onclick="createNewUser()" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Create User</button>
                        <button onclick="closeCreateUserModal()" style="flex: 1; background: #64748b; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Close create user modal
        function closeCreateUserModal() {
            const modal = document.getElementById('createUserModal');
            if (modal) modal.remove();
        }

        // Create new user
        async function createNewUser() {
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;

            if (!email || !password) {
                alert('‚ö†Ô∏è Please enter both email and password.');
                return;
            }

            if (password.length < 6) {
                alert('‚ö†Ô∏è Password must be at least 6 characters long.');
                return;
            }

            if (!window.userManagementService) {
                alert('‚ö†Ô∏è User management service not available.');
                return;
            }

            try {
                const result = await window.userManagementService.createUser(email, password, role);
                if (result.success) {
                    alert(`‚úÖ User created successfully! ${email} can now login.`);
                    closeCreateUserModal();
                    await loadUsersList();
                    await loadUserStatistics();
                } else {
                    alert('‚ùå Error creating user: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating user:', error);
                alert('‚ùå Error creating user: ' + error.message);
            }
        }

        // Edit user
        async function editUser(userId) {
            if (!window.userManagementService) return;

            try {
                const user = await window.userManagementService.getUserById(userId);
                if (!user) {
                    alert('User not found.');
                    return;
                }

                const newRole = prompt(`Current role: ${user.role}\n\nEnter new role (admin/client):`, user.role);
                if (!newRole || (newRole !== 'admin' && newRole !== 'client')) {
                    return;
                }

                const result = await window.userManagementService.changeUserRole(userId, newRole);
                if (result.success) {
                    alert('‚úÖ User role updated successfully!');
                    await loadUsersList();
                    await loadUserStatistics();
                } else {
                    alert('‚ùå Error updating user: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error editing user:', error);
                alert('‚ùå Error editing user: ' + error.message);
            }
        }

        // Toggle user status
        async function toggleUserStatus(userId, active) {
            if (!window.userManagementService) return;

            if (!confirm(`Are you sure you want to ${active ? 'activate' : 'deactivate'} this user?`)) {
                return;
            }

            try {
                const result = await window.userManagementService.setUserActive(userId, active);
                if (result.success) {
                    alert(`‚úÖ User ${active ? 'activated' : 'deactivated'} successfully!`);
                    await loadUsersList();
                    await loadUserStatistics();
                } else {
                    alert('‚ùå Error updating user status: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error toggling user status:', error);
                alert('‚ùå Error updating user status: ' + error.message);
            }
        }

        // Delete user confirmation
        function deleteUserConfirm(userId, userEmail) {
            if (!confirm(`‚ö†Ô∏è Are you sure you want to delete user "${userEmail}"?\n\nThis action cannot be undone!`)) {
                return;
            }
            deleteUser(userId);
        }

        // Delete user
        async function deleteUser(userId) {
            if (!window.userManagementService) return;

            try {
                const result = await window.userManagementService.deleteUser(userId);
                if (result.success) {
                    alert('‚úÖ User deleted successfully!');
                    await loadUsersList();
                    await loadUserStatistics();
                } else {
                    alert('‚ùå Error deleting user: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('‚ùå Error deleting user: ' + error.message);
            }
        }

        // Search users
        async function searchUsers() {
            const searchTerm = document.getElementById('userSearchInput').value.trim();
            if (!window.userManagementService) return;

            try {
                const users = searchTerm 
                    ? await window.userManagementService.searchUsers(searchTerm)
                    : await window.userManagementService.getAllUsers();
                
                const container = document.getElementById('usersListContainer');
                if (users.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;">No users found matching your search.</div>';
                    return;
                }

                let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">';
                html += '<thead><tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Email</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Role</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Status</th>';
                html += '<th style="padding: 12px; text-align: left; font-weight: 600; color: #1e3c72;">Created</th>';
                html += '<th style="padding: 12px; text-align: center; font-weight: 600; color: #1e3c72;">Actions</th>';
                html += '</tr></thead><tbody>';

                users.forEach(user => {
                    const createdAt = user.createdAt?.toDate ? user.createdAt.toDate().toLocaleDateString() : 'N/A';
                    const isActive = user.active !== false;
                    const roleBadge = user.role === 'admin' 
                        ? '<span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">ADMIN</span>'
                        : '<span style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">CLIENT</span>';
                    const statusBadge = isActive
                        ? '<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">ACTIVE</span>'
                        : '<span style="background: #64748b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">INACTIVE</span>';

                    html += `<tr style="border-bottom: 1px solid #e2e8f0;">`;
                    html += `<td style="padding: 12px;">${user.email || 'N/A'}</td>`;
                    html += `<td style="padding: 12px;">${roleBadge}</td>`;
                    html += `<td style="padding: 12px;">${statusBadge}</td>`;
                    html += `<td style="padding: 12px; color: #64748b; font-size: 13px;">${createdAt}</td>`;
                    html += `<td style="padding: 12px; text-align: center;">`;
                    html += `<button onclick="editUser('${user.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-right: 5px;">‚úèÔ∏è Edit</button>`;
                    html += `<button onclick="toggleUserStatus('${user.id}', ${!isActive})" style="background: ${isActive ? '#f59e0b' : '#10b981'}; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; margin-right: 5px;">${isActive ? '‚è∏Ô∏è Deactivate' : '‚ñ∂Ô∏è Activate'}</button>`;
                    html += `<button onclick="deleteUserConfirm('${user.id}', '${user.email}')" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">üóëÔ∏è Delete</button>`;
                    html += `</td>`;
                    html += `</tr>`;
                });

                html += '</tbody></table></div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error searching users:', error);
            }
        }
        
        // ========== END USER MANAGEMENT FUNCTIONS ==========
        
        // Funci√≥n para calcular ingresos netos
        function calcularNetIncome() {
            const income = parseFloat(document.getElementById('schedCIncome').value) || 0;
            const expenses = parseFloat(document.getElementById('schedCExpenses').value) || 0;
            const net = income - expenses;
            
            // Actualizar campos
            document.getElementById('schedCNet').value = '$' + net.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('netIncome').value = '$' + net.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // Actualizar display de p√©rdida
            if (net < 0) {
                document.getElementById('displayLoss').textContent = Math.abs(net).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            }
            
            // Sincronizar con campos principales
            document.getElementById('grossReceipts').value = income;
            document.getElementById('totalExpenses').value = expenses;
        }
        
        // Funci√≥n para calcular totales
        function calcularTotales() {
            const numPersonas = parseInt(document.getElementById('numPersonas').value);
            const precioITIN = parseFloat(document.getElementById('precioITIN').value) || 0;
            const precioJoint = parseFloat(document.getElementById('precioJoint').value) || 0;
            const precioSeparate = parseFloat(document.getElementById('precioSeparate').value) || 0;
            const precioSingle = parseFloat(document.getElementById('precioSingle').value) || 0;
            const precioScheduleC = parseFloat(document.getElementById('precioScheduleC').value) || 0;
            
            // Total ITIN
            const totalITIN = precioITIN * numPersonas;
            document.getElementById('totalITIN').textContent = totalITIN.toFixed(2);
            document.getElementById('displayNumPersonas').textContent = numPersonas;
            
            // Total Tax seg√∫n opci√≥n seleccionada
            let subtotalTax = 0;
            let filingStatusText = '';
            
            if (document.getElementById('optionJoint').checked) {
                subtotalTax = precioJoint;
                filingStatusText = 'Married Filing Jointly';
            } else if (document.getElementById('optionSeparate').checked) {
                subtotalTax = precioSeparate * numPersonas;
                filingStatusText = 'Married Filing Separately';
                document.getElementById('totalSeparate').textContent = subtotalTax.toFixed(2);
            } else if (document.getElementById('optionSingle').checked) {
                subtotalTax = precioSingle;
                filingStatusText = 'Single';
            }
            
            document.getElementById('subtotalTax').textContent = subtotalTax.toFixed(2);
            document.getElementById('displayFilingStatus').textContent = filingStatusText;
            document.getElementById('displayScheduleC').textContent = precioScheduleC.toFixed(2);
            
            // Total General
            const totalGeneral = totalITIN + subtotalTax + precioScheduleC;
            
            // Actualizar tabla resumen
            updateSummaryTable(totalITIN, subtotalTax, precioScheduleC, totalGeneral, numPersonas, filingStatusText);
            
            // Update form visibility when prices change
            updateFormVisibility();
        }
        
        // Funci√≥n para actualizar tabla resumen
        function updateSummaryTable(totalITIN, subtotalTax, scheduleC, total, numPersonas, filingStatus) {
            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = `
                <tr>
                    <td><strong>ITIN & Maryland Certification</strong><br>
                        <small>Gesti√≥n de Identidad Fiscal</small>
                    </td>
                    <td>Documentaci√≥n IRS, SDAT y Banco<br>
                        <small>${numPersonas} persona(s) √ó $${(totalITIN/numPersonas).toFixed(2)}</small>
                    </td>
                    <td class="amount">$${totalITIN.toFixed(2)}</td>
                </tr>
                <tr>
                    <td><strong>Tax Return Preparation</strong><br>
                        <small>Preparaci√≥n de Declaraci√≥n de Impuestos</small>
                    </td>
                    <td>Form 1040 - ${filingStatus}<br>
                        <small>Incluye deducciones y cr√©ditos</small>
                    </td>
                    <td class="amount">$${subtotalTax.toFixed(2)}</td>
                </tr>
                <tr>
                    <td><strong>Schedule C Business Report</strong><br>
                        <small>Reporte de Actividad Comercial</small>
                    </td>
                    <td>Profit/Loss from Business<br>
                        <small>Incluye desglose de gastos deducibles</small>
                    </td>
                    <td class="amount">$${scheduleC.toFixed(2)}</td>
                </tr>
                <tr class="total-row">
                    <td colspan="2" style="text-align: right; font-size: 20px;">
                        <strong>TOTAL INVESTMENT / INVERSI√ìN TOTAL:</strong>
                    </td>
                    <td class="amount">$${total.toFixed(2)}</td>
                </tr>
                <tr style="background: #d4edda;">
                    <td colspan="2" style="text-align: right;">
                        <strong>80% Deposit to Start Services:</strong>
                    </td>
                    <td class="amount" style="color: #28a745; font-weight: 700;">$${(total * 0.8).toFixed(2)}</td>
                </tr>
                <tr style="background: #fff3cd;">
                    <td colspan="2" style="text-align: right;">
                        <strong>20% Balance Due at Form Submission:</strong>
                    </td>
                    <td class="amount" style="color: #856404; font-weight: 700;">$${(total * 0.2).toFixed(2)}</td>
                </tr>
            `;
        }
        
        // Funci√≥n para toggle de edici√≥n
        function toggleEdit() {
            isEditable = !isEditable;
            const inputs = document.querySelectorAll('input:not([readonly]), select:not([disabled]), textarea');
            const editIcon = document.getElementById('editIcon');
            const editText = document.getElementById('editText');
            
            inputs.forEach(input => {
                if (isEditable) {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                } else {
                    if (input.tagName === 'SELECT') {
                        input.setAttribute('disabled', 'true');
                    } else {
                        input.setAttribute('readonly', 'true');
                    }
                }
            });
            
            if (isEditable) {
                editIcon.textContent = 'üîí';
                editText.textContent = 'Lock Editing';
            } else {
                editIcon.textContent = '‚úèÔ∏è';
                editText.textContent = 'Enable Editing';
            }
        }
        
        // Funci√≥n para guardar datos
        // ============================================
        // SISTEMA DE CONTRASE√ëA DEL CLIENTE
        // ============================================
        
        // Generar contrase√±a √∫nica para el cliente
        function generateClientPassword() {
            // Formato: SAH-XXXX-YYYY donde XXXX es alfanum√©rico y YYYY es num√©rico
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Sin I, O, 0, 1 para evitar confusi√≥n
            const numbers = '0123456789';
            
            let password = 'SAH-';
            
            // 4 caracteres alfanum√©ricos
            for (let i = 0; i < 4; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            password += '-';
            
            // 4 d√≠gitos num√©ricos
            for (let i = 0; i < 4; i++) {
                password += numbers.charAt(Math.floor(Math.random() * numbers.length));
            }
            
            return password;
        }
        
        // Inicializar o cargar contrase√±a del cliente
        function initClientPassword() {
            const passwordField = document.getElementById('clientPassword');
            if (!passwordField) {
                // Si el campo no existe a√∫n, intentar de nuevo despu√©s de un breve delay
                setTimeout(initClientPassword, 100);
                return;
            }
            
            // Intentar cargar contrase√±a guardada
            const savedData = localStorage.getItem('secureAssetsQuote2025');
            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);
                    if (formData.clientPassword && formData.clientPassword.trim() !== '') {
                        passwordField.value = formData.clientPassword;
                        return;
                    }
                } catch (e) {
                    console.error('Error loading password:', e);
                }
            }
            
            // Si no hay contrase√±a guardada, generar una nueva
            const newPassword = generateClientPassword();
            passwordField.value = newPassword;
            
            // Guardar inmediatamente
            saveClientPassword(newPassword);
        }
        
        // Guardar contrase√±a
        function saveClientPassword(password) {
            const savedData = localStorage.getItem('secureAssetsQuote2025');
            let formData = {};
            
            if (savedData) {
                try {
                    formData = JSON.parse(savedData);
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                }
            }
            
            formData.clientPassword = password;
            localStorage.setItem('secureAssetsQuote2025', JSON.stringify(formData));
        }
        
        // Copiar contrase√±a al portapapeles
        function copyPassword(event) {
            const passwordField = document.getElementById('clientPassword');
            if (!passwordField || !passwordField.value) {
                alert('No password to copy');
                return;
            }
            
            const password = passwordField.value;
            
            // Intentar usar la API moderna del portapapeles
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(password).then(() => {
                    // Feedback visual
                    if (event && event.target) {
                        const button = event.target;
                        const originalText = button.innerHTML;
                        button.innerHTML = '‚úì Copiado';
                        button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                        
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                        }, 2000);
                    }
                }).catch(err => {
                    console.error('Error al copiar:', err);
                    fallbackCopy(password);
                });
            } else {
                // Fallback para navegadores antiguos
                fallbackCopy(password);
            }
        }
        
        // M√©todo alternativo para copiar
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úÖ Password copied: ' + text);
            } catch (err) {
                console.error('Error al copiar:', err);
                alert('Could not copy automatically. Please copy manually: ' + text);
            }
            
            document.body.removeChild(textArea);
        }
        
        // Regenerar nueva contrase√±a
        function regeneratePassword() {
            if (!confirm('Are you sure you want to generate a new password? The previous password will no longer be valid.')) {
                return;
            }
            
            const newPassword = generateClientPassword();
            const passwordField = document.getElementById('clientPassword');
            
            if (passwordField) {
                passwordField.value = newPassword;
                saveClientPassword(newPassword);
                
                // Feedback visual
                passwordField.style.animation = 'none';
                setTimeout(() => {
                    passwordField.style.animation = 'pulse 0.5s ease-in-out';
                }, 10);
                
                alert('‚úÖ New password generated: ' + newPassword);
            }
        }
        
        async function saveData() {
            const formData = {
                // Metadata
                quoteNumber: document.getElementById('quoteNumber').value,
                preparador: document.getElementById('preparador').value,
                fechaEmision: document.getElementById('fechaEmision').value,
                fechaValidez: document.getElementById('fechaValidez').value,
                clientPassword: document.getElementById('clientPassword')?.value || '',
                
                // Cliente 1
                firstName1: document.getElementById('firstName1').value,
                middleName1: document.getElementById('middleName1').value,
                lastName1: document.getElementById('lastName1').value,
                dob1: document.getElementById('dob1').value,
                citizenship1: document.getElementById('citizenship1').value,
                birthCountry1: document.getElementById('birthCountry1').value,
                passport1: document.getElementById('passport1').value,
                passportIssue1: document.getElementById('passportIssue1').value,
                passportExp1: document.getElementById('passportExp1').value,
                ssn1: document.getElementById('ssn1').value,
                visaType1: document.getElementById('visaType1').value,
                foreignTaxId1: document.getElementById('foreignTaxId1').value,
                occupation1: document.getElementById('occupation1').value,
                
                // Cliente 2
                firstName2: document.getElementById('firstName2').value,
                middleName2: document.getElementById('middleName2').value,
                lastName2: document.getElementById('lastName2').value,
                dob2: document.getElementById('dob2').value,
                citizenship2: document.getElementById('citizenship2').value,
                birthCountry2: document.getElementById('birthCountry2').value,
                passport2: document.getElementById('passport2').value,
                passportIssue2: document.getElementById('passportIssue2').value,
                passportExp2: document.getElementById('passportExp2').value,
                ssn2: document.getElementById('ssn2').value,
                visaType2: document.getElementById('visaType2').value,
                foreignTaxId2: document.getElementById('foreignTaxId2').value,
                occupation2: document.getElementById('occupation2').value,
                
                // Direcci√≥n
                street: document.getElementById('street').value,
                apt: document.getElementById('apt').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip: document.getElementById('zip').value,
                phone: document.getElementById('phone').value,
                altPhone: document.getElementById('altPhone').value,
                email: document.getElementById('email').value,
                
                // Estado civil
                maritalStatus: document.getElementById('maritalStatus').value,
                marriageDate: document.getElementById('marriageDate').value,
                dependents: document.getElementById('dependents').value,
                numPersonas: document.getElementById('numPersonas').value,
                
                // LLC
                llcName: document.getElementById('llcName').value,
                mdDeptId: document.getElementById('mdDeptId').value,
                ein: document.getElementById('ein').value,
                llcFormationDate: document.getElementById('llcFormationDate').value,
                llcState: document.getElementById('llcState').value,
                businessType: document.getElementById('businessType').value,
                naicsCode: document.getElementById('naicsCode').value,
                llcAddress: document.getElementById('llcAddress').value,
                llcMembers: document.getElementById('llcMembers').value,
                
                // Financiero
                grossReceipts: document.getElementById('grossReceipts').value,
                totalExpenses: document.getElementById('totalExpenses').value,
                num1099: document.getElementById('num1099').value,
                
                // Precios
                precioITIN: document.getElementById('precioITIN').value,
                precioJoint: document.getElementById('precioJoint').value,
                precioSeparate: document.getElementById('precioSeparate').value,
                precioSingle: document.getElementById('precioSingle').value,
                precioScheduleC: document.getElementById('precioScheduleC').value,
                
                // Opciones
                filingStatus: document.querySelector('input[name="filingStatus"]:checked')?.value || 'joint',
                
                // Notas
                additionalNotes: document.getElementById('additionalNotes').value
            };
            
            // Generate or get quote ID
            const quoteNumber = formData.quoteNumber || 'ET-2025-001';
            const quoteId = quoteNumber.replace(/\s+/g, '-').toLowerCase();
            
            // Save to database (Firestore with localStorage fallback)
            try {
                const result = await databaseService.saveClientQuote(quoteId, formData);
                if (result.success) {
                    const sourceMsg = result.source === 'firestore' ? ' (saved to cloud database)' : 
                                     result.source === 'localStorage-fallback' ? ' (saved locally - Firebase not configured)' : 
                                     ' (saved locally)';
                    alert('‚úÖ Data saved successfully - SECURE ASSETS HOLDING LLC' + sourceMsg);
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('Error saving data:', error);
                alert('‚ö†Ô∏è Error saving data: ' + error.message);
            }
        }
        
        // Funci√≥n para cargar datos guardados
        async function loadSavedData(quoteId = null, password = null) {
            let formData = null;
            
            // Try to load from database
            if (quoteId) {
                const result = await databaseService.loadClientQuote(quoteId);
                if (result.success) {
                    formData = result.data;
                }
            } else if (password) {
                const result = await databaseService.searchClientByPassword(password);
                if (result.success) {
                    formData = result.data;
                }
            } else {
                // Fallback to localStorage
                const savedData = localStorage.getItem('secureAssetsQuote2025');
                if (savedData) {
                    formData = JSON.parse(savedData);
                }
            }
            
            if (formData) {
                Object.keys(formData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && key !== 'clientPassword' && key !== 'createdAt' && key !== 'updatedAt' && key !== 'quoteId') {
                        element.value = formData[key];
                    }
                });
                
                // Cargar contrase√±a si existe (solo si no se ha inicializado ya)
                if (formData.clientPassword && formData.clientPassword.trim() !== '') {
                    const passwordField = document.getElementById('clientPassword');
                    if (passwordField && (!passwordField.value || passwordField.value.trim() === '')) {
                        passwordField.value = formData.clientPassword;
                    }
                }
                
                // Restaurar radio button
                if (formData.filingStatus) {
                    const radioToCheck = document.querySelector(`input[name="filingStatus"][value="${formData.filingStatus}"]`);
                    if (radioToCheck) radioToCheck.checked = true;
                }
                
                calcularTotales();
                calcularNetIncome();
            }
        }
        
        // Funci√≥n para auto-llenar con datos demo
        function autoFill() {
            document.getElementById('firstName1').value = 'Juan Carlos';
            document.getElementById('lastName1').value = 'Garc√≠a Hern√°ndez';
            document.getElementById('dob1').value = '1985-03-15';
            document.getElementById('citizenship1').value = 'Mexico';
            document.getElementById('birthCountry1').value = 'Mexico';
            document.getElementById('passport1').value = 'G12345678';
            document.getElementById('passportExp1').value = '2028-12-31';
            document.getElementById('occupation1').value = 'Business Owner';
            
            document.getElementById('firstName2').value = 'Mar√≠a Elena';
            document.getElementById('lastName2').value = 'Rodr√≠guez L√≥pez';
            document.getElementById('dob2').value = '1987-07-22';
            document.getElementById('citizenship2').value = 'Mexico';
            document.getElementById('birthCountry2').value = 'Mexico';
            document.getElementById('passport2').value = 'G87654321';
            document.getElementById('passportExp2').value = '2027-11-30';
            document.getElementById('occupation2').value = 'Business Owner';
            
            document.getElementById('street').value = '1234 Main Street';
            document.getElementById('city').value = 'Baltimore';
            document.getElementById('zip').value = '21201';
            document.getElementById('phone').value = '(410) 555-1234';
            document.getElementById('email').value = 'jgarcia@example.com';
            
            document.getElementById('llcName').value = 'GARCIA CONSTRUCTION LLC';
            document.getElementById('ein').value = '12-3456789';
            document.getElementById('llcFormationDate').value = '2023-01-15';
            document.getElementById('businessType').value = 'Construction Services';
            document.getElementById('llcMembers').value = 'Juan Carlos Garc√≠a - 50%, Mar√≠a Elena Rodr√≠guez - 50%';
            
            document.getElementById('maritalStatus').value = 'married';
            
            calcularTotales();
            calcularNetIncome();
            
            alert('‚úÖ Form filled with demo data');
        }
        
        // ============================================
        // TAB NAVIGATION FUNCTIONS
        // ============================================
        
        function showTab(tabName) {
            // Hide all tab contents
            document.getElementById('tab-content-quote').style.display = 'none';
            document.getElementById('tab-content-forms').style.display = 'none';
            
            // Remove active class from all tabs
            document.getElementById('tab-quote').classList.remove('active');
            document.getElementById('tab-forms').classList.remove('active');
            document.getElementById('tab-quote').style.borderBottomColor = 'transparent';
            document.getElementById('tab-quote').style.color = '#64748b';
            document.getElementById('tab-quote').style.fontWeight = '600';
            document.getElementById('tab-forms').style.borderBottomColor = 'transparent';
            document.getElementById('tab-forms').style.color = '#64748b';
            document.getElementById('tab-forms').style.fontWeight = '600';
            
            // Show selected tab content and activate tab button
            if (tabName === 'quote') {
                document.getElementById('tab-content-quote').style.display = 'block';
                document.getElementById('tab-quote').classList.add('active');
                document.getElementById('tab-quote').style.borderBottomColor = '#2563eb';
                document.getElementById('tab-quote').style.color = '#2563eb';
                document.getElementById('tab-quote').style.fontWeight = '700';
            } else if (tabName === 'forms') {
                document.getElementById('tab-content-forms').style.display = 'block';
                document.getElementById('tab-forms').classList.add('active');
                document.getElementById('tab-forms').style.borderBottomColor = '#2563eb';
                document.getElementById('tab-forms').style.color = '#2563eb';
                document.getElementById('tab-forms').style.fontWeight = '700';
                // Auto-fill forms when switching to forms tab
                autoFillAllForms();
            }
        }
        
        // ============================================
        // FORM AUTO-FILL FUNCTIONS
        // ============================================
        
        function autoFillAllForms() {
            fillW7Form();
            fill1040Form();
            fillScheduleCForm();
            updateFormVisibility();
        }
        
        function fillW7Form() {
            // Taxpayer 1
            const firstName1 = document.getElementById('firstName1')?.value || '';
            const middleName1 = document.getElementById('middleName1')?.value || '';
            const lastName1 = document.getElementById('lastName1')?.value || '';
            const fullName1 = `${firstName1} ${middleName1} ${lastName1}`.trim();
            
            document.getElementById('w7-name1').value = fullName1;
            document.getElementById('w7-address1').value = document.getElementById('street')?.value || '';
            const city = document.getElementById('city')?.value || '';
            const state = document.getElementById('state')?.value || '';
            const zip = document.getElementById('zip')?.value || '';
            document.getElementById('w7-city-state-zip1').value = `${city}, ${state} ${zip}`.trim();
            
            const dob1 = document.getElementById('dob1')?.value || '';
            if (dob1) {
                const dateObj = new Date(dob1);
                const formatted = `${String(dateObj.getMonth() + 1).padStart(2, '0')}/${String(dateObj.getDate()).padStart(2, '0')}/${dateObj.getFullYear()}`;
                document.getElementById('w7-dob1').value = formatted;
            }
            
            document.getElementById('w7-birth-country1').value = document.getElementById('birthCountry1')?.value || '';
            document.getElementById('w7-citizenship1').value = document.getElementById('citizenship1')?.value || '';
            document.getElementById('w7-passport1').value = document.getElementById('passport1')?.value || '';
            
            const passportExp1 = document.getElementById('passportExp1')?.value || '';
            if (passportExp1) {
                const dateObj = new Date(passportExp1);
                const formatted = `${String(dateObj.getMonth() + 1).padStart(2, '0')}/${String(dateObj.getDate()).padStart(2, '0')}/${dateObj.getFullYear()}`;
                document.getElementById('w7-passport-exp1').value = formatted;
            }
            
            // Signature
            document.getElementById('w7-signature1').textContent = fullName1;
            
            // Spouse (if applicable)
            const firstName2 = document.getElementById('firstName2')?.value || '';
            const middleName2 = document.getElementById('middleName2')?.value || '';
            const lastName2 = document.getElementById('lastName2')?.value || '';
            const maritalStatus = document.getElementById('maritalStatus')?.value || '';
            
            if ((firstName2 || lastName2) && maritalStatus === 'married') {
                document.getElementById('w7-spouse-section').style.display = 'block';
                const fullName2 = `${firstName2} ${middleName2} ${lastName2}`.trim();
                document.getElementById('w7-name2').value = fullName2;
                
                const dob2 = document.getElementById('dob2')?.value || '';
                if (dob2) {
                    const dateObj = new Date(dob2);
                    const formatted = `${String(dateObj.getMonth() + 1).padStart(2, '0')}/${String(dateObj.getDate()).padStart(2, '0')}/${dateObj.getFullYear()}`;
                    document.getElementById('w7-dob2').value = formatted;
                }
                
                document.getElementById('w7-birth-country2').value = document.getElementById('birthCountry2')?.value || '';
                document.getElementById('w7-citizenship2').value = document.getElementById('citizenship2')?.value || '';
                document.getElementById('w7-passport2').value = document.getElementById('passport2')?.value || '';
                document.getElementById('w7-signature2').textContent = fullName2;
            } else {
                document.getElementById('w7-spouse-section').style.display = 'none';
            }
        }
        
        function fill1040Form() {
            const filingStatus = document.querySelector('input[name="filingStatus"]:checked')?.value || 'joint';
            const filingStatusText = filingStatus === 'joint' ? 'Married Filing Jointly' : 
                                     filingStatus === 'separate' ? 'Married Filing Separately' : 
                                     'Single';
            
            document.getElementById('1040-filing-status').value = filingStatusText;
            
            // Names
            document.getElementById('1040-name1-first').value = document.getElementById('firstName1')?.value || '';
            document.getElementById('1040-name1-last').value = document.getElementById('lastName1')?.value || '';
            
            // Address
            document.getElementById('1040-address').value = document.getElementById('street')?.value || '';
            const city = document.getElementById('city')?.value || '';
            const state = document.getElementById('state')?.value || '';
            const zip = document.getElementById('zip')?.value || '';
            document.getElementById('1040-city-state-zip').value = `${city}, ${state} ${zip}`.trim();
            
            // Standard deduction
            const standardDeduction = filingStatus === 'joint' ? '$29,200' : '$14,600';
            document.getElementById('1040-standard-deduction').value = standardDeduction;
            
            // Signature
            const firstName1 = document.getElementById('firstName1')?.value || '';
            const lastName1 = document.getElementById('lastName1')?.value || '';
            document.getElementById('1040-signature1').textContent = `${firstName1} ${lastName1}`.trim();
            
            // Spouse fields (if filing jointly)
            if (filingStatus === 'joint') {
                document.getElementById('1040-spouse-name-group').style.display = 'block';
                document.getElementById('1040-spouse-last-group').style.display = 'block';
                document.getElementById('1040-spouse-ssn-group').style.display = 'block';
                document.getElementById('1040-spouse-sign-section').style.display = 'block';
                document.getElementById('1040-spouse-date-section').style.display = 'block';
                
                document.getElementById('1040-name2-first').value = document.getElementById('firstName2')?.value || '';
                document.getElementById('1040-name2-last').value = document.getElementById('lastName2')?.value || '';
                
                const firstName2 = document.getElementById('firstName2')?.value || '';
                const lastName2 = document.getElementById('lastName2')?.value || '';
                document.getElementById('1040-signature2').textContent = `${firstName2} ${lastName2}`.trim();
            } else {
                document.getElementById('1040-spouse-name-group').style.display = 'none';
                document.getElementById('1040-spouse-last-group').style.display = 'none';
                document.getElementById('1040-spouse-ssn-group').style.display = 'none';
                document.getElementById('1040-spouse-sign-section').style.display = 'none';
                document.getElementById('1040-spouse-date-section').style.display = 'none';
            }
        }
        
        function fillScheduleCForm() {
            // Business info
            document.getElementById('sc-business-name').value = document.getElementById('llcName')?.value || '';
            document.getElementById('sc-business-address').value = document.getElementById('llcAddress')?.value || document.getElementById('street')?.value || '';
            document.getElementById('sc-ein').value = document.getElementById('ein')?.value || '';
            document.getElementById('sc-business-type').value = document.getElementById('businessType')?.value || '';
            
            // Income and expenses
            const grossReceipts = parseFloat(document.getElementById('grossReceipts')?.value || document.getElementById('schedCIncome')?.value || 0);
            const totalExpenses = parseFloat(document.getElementById('totalExpenses')?.value || document.getElementById('schedCExpenses')?.value || 0);
            const netIncome = grossReceipts - totalExpenses;
            
            document.getElementById('sc-gross-receipts').value = grossReceipts.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('sc-total-expenses').value = totalExpenses.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('sc-net-income').value = netIncome.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('sc-net-profit-loss').value = netIncome.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        
        function updateFormVisibility() {
            // Show W-7 if ITIN service is selected (check if precioITIN has value > 0)
            const itinPrice = parseFloat(document.getElementById('precioITIN')?.value || 0);
            document.getElementById('form-w7-section').style.display = itinPrice > 0 ? 'block' : 'none';
            
            // Show 1040 if tax preparation is selected
            const jointPrice = parseFloat(document.getElementById('precioJoint')?.value || 0);
            const separatePrice = parseFloat(document.getElementById('precioSeparate')?.value || 0);
            const singlePrice = parseFloat(document.getElementById('precioSingle')?.value || 0);
            const hasTaxPrep = jointPrice > 0 || separatePrice > 0 || singlePrice > 0;
            document.getElementById('form-1040-section').style.display = hasTaxPrep ? 'block' : 'none';
            
            // Show Schedule C if Schedule C service is selected
            const scheduleCPrice = parseFloat(document.getElementById('precioScheduleC')?.value || 0);
            document.getElementById('form-schedulec-section').style.display = scheduleCPrice > 0 ? 'block' : 'none';
        }
        
        function printForm(formType) {
            const formSection = document.getElementById(`form-${formType}-section`);
            if (!formSection) return;
            
            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Form ${formType.toUpperCase()}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            .form-group { margin-bottom: 15px; }
                            label { font-weight: bold; display: block; margin-bottom: 5px; }
                            input, select { width: 100%; padding: 5px; border: 1px solid #ccc; }
                            input[readonly] { background: #f5f5f5; }
                            .section-header { background: #1e3c72; color: white; padding: 15px; margin-bottom: 20px; }
                        </style>
                    </head>
                    <body>
                        ${formSection.innerHTML}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }
        
        // Funci√≥n para imprimir PDF
        function printPDF() {
            // Guardar antes de imprimir
            saveData();
            
            // Bloquear edici√≥n temporalmente
            const wasEditable = isEditable;
            if (isEditable) {
                toggleEdit();
            }
            
            // Imprimir
            window.print();
            
            // Restaurar estado
            setTimeout(() => {
                if (wasEditable && !isEditable) {
                    toggleEdit();
                }
            }, 500);
        }
        
        // ============================================
        // CLIENT DATABASE FUNCTIONS
        // ============================================
        
        // Show client list modal
        async function showClientList() {
            const modal = document.getElementById('clientListModal');
            if (modal) {
                modal.style.display = 'block';
                await refreshClientList();
            }
        }
        
        // Close client list modal
        function closeClientList() {
            const modal = document.getElementById('clientListModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // Refresh client list
        async function refreshClientList() {
            const container = document.getElementById('clientListContainer');
            const statusText = document.getElementById('dbStatusText');
            
            if (!container) return;
            
            // Update status
            const isFirestore = databaseService.isFirestoreAvailable();
            if (statusText) {
                statusText.textContent = isFirestore ? 
                    'Connected to Firestore Database' : 
                    'Using localStorage (Firebase not configured)';
                const statusDiv = document.getElementById('dbStatus');
                if (statusDiv) {
                    statusDiv.style.background = isFirestore ? '#d1fae5' : '#fff3cd';
                    statusDiv.style.borderColor = isFirestore ? '#10b981' : '#ffc107';
                }
            }
            
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;"><div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div><div>Loading clients...</div></div>';
            
            try {
                const result = await databaseService.getAllClients(100);
                
                if (result.success && result.clients && result.clients.length > 0) {
                    let html = '<div style="display: grid; gap: 15px;">';
                    
                    result.clients.forEach((client, index) => {
                        if (client.deleted) return; // Skip deleted clients
                        
                        const clientName = `${client.firstName1 || ''} ${client.lastName1 || ''}`.trim() || 'Unnamed Client';
                        const clientEmail = client.email || 'No email';
                        const quoteNum = client.quoteNumber || 'N/A';
                        const password = client.clientPassword || 'N/A';
                        const createdAt = client.createdAt ? (client.createdAt.toDate ? client.createdAt.toDate().toLocaleDateString() : client.createdAt) : 'Unknown';
                        
                        html += `
                            <div style="border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; background: #f8fafc; transition: all 0.3s;" onmouseover="this.style.borderColor='#2563eb'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                    <div>
                                        <h3 style="color: #1e3c72; margin: 0 0 8px 0; font-size: 20px;">${clientName}</h3>
                                        <div style="color: #64748b; font-size: 14px;">
                                            <strong>Quote #:</strong> ${quoteNum}<br>
                                            <strong>Email:</strong> ${clientEmail}<br>
                                            <strong>Password:</strong> <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px;">${password}</code><br>
                                            <strong>Created:</strong> ${createdAt}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button onclick="loadClientById('${client.quoteId || quoteNum.replace(/\s+/g, '-').toLowerCase()}')" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üìÑ Load</button>
                                        <button onclick="deleteClient('${client.quoteId || quoteNum.replace(/\s+/g, '-').toLowerCase()}')" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üóëÔ∏è Delete</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #64748b;">
                            <div style="font-size: 48px; margin-bottom: 15px;">üì≠</div>
                            <div style="font-size: 18px; margin-bottom: 10px;">No clients found</div>
                            <div style="font-size: 14px;">Save a quote to see it appear here</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading clients:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                        <div style="font-size: 18px; margin-bottom: 10px;">Error loading clients</div>
                        <div style="font-size: 14px;">${error.message}</div>
                    </div>
                `;
            }
        }
        
        // Load client by ID
        async function loadClientById(quoteId) {
            try {
                await loadSavedData(quoteId);
                closeClientList();
                alert('‚úÖ Client data loaded successfully');
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading client:', error);
                alert('‚ö†Ô∏è Error loading client: ' + error.message);
            }
        }
        
        // Search clients
        async function searchClients() {
            const searchInput = document.getElementById('clientSearchInput');
            const searchTerm = searchInput?.value.trim().toLowerCase();
            
            if (!searchTerm) {
                await refreshClientList();
                return;
            }
            
            const container = document.getElementById('clientListContainer');
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #64748b;"><div style="font-size: 48px; margin-bottom: 15px;">üîç</div><div>Searching...</div></div>';
            
            try {
                const result = await databaseService.getAllClients(100);
                
                if (result.success && result.clients) {
                    const filtered = result.clients.filter(client => {
                        if (client.deleted) return false;
                        
                        const name = `${client.firstName1 || ''} ${client.lastName1 || ''}`.toLowerCase();
                        const email = (client.email || '').toLowerCase();
                        const quote = (client.quoteNumber || '').toLowerCase();
                        const password = (client.clientPassword || '').toLowerCase();
                        
                        return name.includes(searchTerm) || 
                               email.includes(searchTerm) || 
                               quote.includes(searchTerm) || 
                               password.includes(searchTerm);
                    });
                    
                    if (filtered.length > 0) {
                        let html = '<div style="display: grid; gap: 15px;">';
                        
                        filtered.forEach(client => {
                            const clientName = `${client.firstName1 || ''} ${client.lastName1 || ''}`.trim() || 'Unnamed Client';
                            const clientEmail = client.email || 'No email';
                            const quoteNum = client.quoteNumber || 'N/A';
                            const password = client.clientPassword || 'N/A';
                            const createdAt = client.createdAt ? (client.createdAt.toDate ? client.createdAt.toDate().toLocaleDateString() : client.createdAt) : 'Unknown';
                            
                            html += `
                                <div style="border: 2px solid #e2e8f0; border-radius: 12px; padding: 20px; background: #f8fafc;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <h3 style="color: #1e3c72; margin: 0 0 8px 0;">${clientName}</h3>
                                            <div style="color: #64748b; font-size: 14px;">
                                                <strong>Quote #:</strong> ${quoteNum}<br>
                                                <strong>Email:</strong> ${clientEmail}<br>
                                                <strong>Password:</strong> <code style="background: #e2e8f0; padding: 2px 6px; border-radius: 4px;">${password}</code><br>
                                                <strong>Created:</strong> ${createdAt}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="loadClientById('${client.quoteId || quoteNum.replace(/\s+/g, '-').toLowerCase()}')" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üìÑ Load</button>
                                            <button onclick="deleteClient('${client.quoteId || quoteNum.replace(/\s+/g, '-').toLowerCase()}')" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">üóëÔ∏è Delete</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += '</div>';
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #64748b;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üîç</div>
                                <div>No clients found matching "${searchTerm}"</div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error searching clients:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <div>Error searching: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        // Delete client
        async function deleteClient(quoteId) {
            if (!confirm('Are you sure you want to delete this client? This action cannot be undone.')) {
                return;
            }
            
            try {
                const result = await databaseService.deleteClient(quoteId);
                if (result.success) {
                    alert('‚úÖ Client deleted successfully');
                    await refreshClientList();
                } else {
                    throw new Error(result.error || 'Unknown error');
                }
            } catch (error) {
                console.error('Error deleting client:', error);
                alert('‚ö†Ô∏è Error deleting client: ' + error.message);
            }
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('clientListModal');
            if (modal && event.target === modal) {
                closeClientList();
            }
        });
        
        // Allow Enter key to search
        document.addEventListener('keydown', function(event) {
            const searchInput = document.getElementById('clientSearchInput');
            if (event.key === 'Enter' && searchInput && document.activeElement === searchInput) {
                searchClients();
            }
        });
        
        // Actualizar nombres en firmas
        document.getElementById('firstName1').addEventListener('input', updateSignatureNames);
        document.getElementById('lastName1').addEventListener('input', updateSignatureNames);
        document.getElementById('firstName2').addEventListener('input', updateSignatureNames);
        document.getElementById('lastName2').addEventListener('input', updateSignatureNames);
        
        function updateSignatureNames() {
            const name1 = (document.getElementById('firstName1').value + ' ' + document.getElementById('lastName1').value).trim();
            const name2 = (document.getElementById('firstName2').value + ' ' + document.getElementById('lastName2').value).trim();
            
            if (name1) {
                document.getElementById('signatureName1').textContent = name1;
            }
            if (name2) {
                document.getElementById('signatureName2').textContent = name2 || 'C√≥nyuge / Spouse';
            }
        }
        
        // ============================================
        // FIRMA DIGITAL / DIGITAL SIGNATURE SYSTEM
        // ============================================
        
        // Variables para los canvas de firma
        const signatureCanvases = {};
        const signatureContexts = {};
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let points = []; // Para suavizado de l√≠neas
        let signatureSettings = {
            color: '#1e3c72',
            thickness: 2.5,
            smoothing: true
        };
        
        // Detectar tipo de dispositivo
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   (navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform));
        }
        
        // Actualizar estilo del canvas (debe estar antes de initSignatureCanvases)
        function updateCanvasStyle(ctx, canvasId) {
            const isMobile = isMobileDevice();
            const thicknessInput = document.getElementById('signatureThickness');
            const colorInput = document.getElementById('signatureColor');
            const thickness = parseFloat(thicknessInput?.value || signatureSettings.thickness);
            const color = colorInput?.value || signatureSettings.color;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = isMobile ? Math.max(thickness, 3) : thickness;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.globalCompositeOperation = 'source-over';
            
            // Actualizar valor mostrado
            const thicknessValue = document.getElementById('thicknessValue');
            if (thicknessValue && thicknessInput) {
                thicknessValue.textContent = thickness.toFixed(1) + 'px';
            }
        }
        
        function updateSignatureStyle() {
            Object.keys(signatureContexts).forEach(canvasId => {
                const ctx = signatureContexts[canvasId];
                updateCanvasStyle(ctx, canvasId);
            });
        }
        
        // Inicializar canvas de firmas
        function initSignatureCanvases() {
            const canvasIds = ['clientDigitalSignature', 'preparerSignatureCanvas'];
            const isMobile = isMobileDevice();
            
            // Mostrar informaci√≥n del dispositivo
            const deviceInfo = document.getElementById('deviceInfo');
            const hintText = document.getElementById('hintText');
            if (deviceInfo) {
                deviceInfo.textContent = isMobile ? '(Firme con el dedo)' : '(Firme con el mouse)';
            }
            if (hintText) {
                hintText.textContent = isMobile ? 'Firme aqu√≠ con el dedo' : 'Firme aqu√≠ con el mouse';
            }
            
            canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                    signatureCanvases[id] = canvas;
                    signatureContexts[id] = canvas.getContext('2d', { willReadFrequently: true });
                    
                    // Funci√≥n para ajustar tama√±o del canvas
                    function resizeCanvas() {
                        const rect = canvas.getBoundingClientRect();
                        const dpr = window.devicePixelRatio || 1;
                        const displayWidth = Math.floor(rect.width);
                        const displayHeight = Math.floor(rect.height);
                        
                        // Asegurar que el canvas tenga el tama√±o correcto
                        const scaledWidth = Math.floor(displayWidth * dpr);
                        const scaledHeight = Math.floor(displayHeight * dpr);
                        
                        if (canvas.width !== scaledWidth || canvas.height !== scaledHeight) {
                            // Guardar el contenido actual si existe
                            const ctx = signatureContexts[id];
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            
                            // Ajustar tama√±o
                            canvas.width = scaledWidth;
                            canvas.height = scaledHeight;
                            
                            // Restaurar contenido si hab√≠a algo
                            if (imageData.data.some((pixel, index) => index % 4 === 3 && pixel > 0)) {
                                ctx.putImageData(imageData, 0, 0);
                            }
                            
                            ctx.scale(dpr, dpr);
                            
                            // Reconfigurar estilo despu√©s de resize
                            updateCanvasStyle(ctx, id);
                        }
                    }
                    
                    // Ajustar tama√±o inicial
                    resizeCanvas();
                    
                    // Reajustar en resize de ventana
                    const resizeHandler = () => resizeCanvas();
                    window.addEventListener('resize', resizeHandler);
                    
                    // Configurar estilo de dibujo inicial
                    const ctx = signatureContexts[id];
                    updateCanvasStyle(ctx, id);
                    
                    // Event listeners para mouse (solo desktop)
                    if (!isMobile) {
                        canvas.addEventListener('mousedown', (e) => {
                            e.preventDefault();
                            startDrawing(e, id);
                        });
                        canvas.addEventListener('mousemove', (e) => {
                            e.preventDefault();
                            if (isDrawing) draw(e, id);
                        });
                        canvas.addEventListener('mouseup', (e) => {
                            e.preventDefault();
                            stopDrawing();
                        });
                        canvas.addEventListener('mouseout', (e) => {
                            e.preventDefault();
                            stopDrawing();
                        });
                    }
                    
                    // Event listeners para touch (m√≥vil y tablets)
                    canvas.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        // Prevenir scroll mientras se firma
                        document.body.classList.add('signing');
                        
                        const touch = e.touches[0];
                        if (touch) {
                            startDrawing(touch, id);
                        }
                    }, { passive: false });
                    
                    canvas.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        if (isDrawing && e.touches.length > 0) {
                            const touch = e.touches[0];
                            if (touch) {
                                draw(touch, id);
                            }
                        }
                    }, { passive: false });
                    
                    canvas.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        stopDrawing();
                        
                        // Permitir scroll de nuevo despu√©s de un breve delay
                        setTimeout(() => {
                            document.body.classList.remove('signing');
                        }, 100);
                    }, { passive: false });
                    
                    canvas.addEventListener('touchcancel', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        stopDrawing();
                        
                        // Permitir scroll de nuevo inmediatamente
                        document.body.classList.remove('signing');
                    }, { passive: false });
                }
            });
            
            // Ocultar hint cuando se empiece a dibujar
            const clientCanvas = document.getElementById('clientDigitalSignature');
            if (clientCanvas) {
                const hideOnStart = () => {
                    hideHint();
                    clientCanvas.removeEventListener('mousedown', hideOnStart);
                    clientCanvas.removeEventListener('touchstart', hideOnStart);
                };
                clientCanvas.addEventListener('mousedown', hideOnStart);
                clientCanvas.addEventListener('touchstart', hideOnStart);
            }
            
            // Actualizar timestamp
            updateTimestamp();
        }
        
        function hideHint() {
            const hint = document.getElementById('signatureHint');
            if (hint) {
                hint.style.opacity = '0';
                hint.style.transition = 'opacity 0.3s';
            }
            updateSignatureStatus('Signing...', '#007bff');
        }
        
        function updateSignatureStatus(text, color = '#666') {
            const statusEl = document.getElementById('signatureStatusText');
            if (statusEl) {
                statusEl.textContent = text;
                statusEl.style.color = color;
            }
        }
        
        function getCoordinates(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            
            let clientX, clientY;
            let pressure = 1.0;
            
            if (e.touches && e.touches.length > 0) {
                const touch = e.touches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
                // Detectar presi√≥n en dispositivos compatibles
                if (touch.force && touch.force > 0) {
                    pressure = Math.max(0.5, Math.min(1.5, touch.force));
                }
            } else if (e.changedTouches && e.changedTouches.length > 0) {
                // Para touchend y touchcancel
                const touch = e.changedTouches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
                // Detectar presi√≥n en stylus
                if (e.pressure !== undefined && e.pressure > 0) {
                    pressure = Math.max(0.5, Math.min(1.5, e.pressure));
                }
            }
            
            // Calcular coordenadas relativas al canvas
            const x = (clientX - rect.left) * dpr;
            const y = (clientY - rect.top) * dpr;
            
            return { x, y, pressure };
        }
        
        function startDrawing(e, canvasId) {
            isDrawing = true;
            points = [];
            const canvas = signatureCanvases[canvasId];
            const ctx = signatureContexts[canvasId];
            const coords = getCoordinates(e, canvas);
            
            lastX = coords.x;
            lastY = coords.y;
            points.push({ x: lastX, y: lastY, pressure: coords.pressure });
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            hideHint();
            updateSignatureStatus('Signing...', '#007bff');
        }
        
        function draw(e, canvasId) {
            if (!isDrawing) return;
            const canvas = signatureCanvases[canvasId];
            const ctx = signatureContexts[canvasId];
            const coords = getCoordinates(e, canvas);
            
            // Agregar punto para suavizado
            points.push({ x: coords.x, y: coords.y, pressure: coords.pressure });
            
            // Limitar puntos para rendimiento
            if (points.length > 50) {
                points.shift();
            }
            
            // Suavizado mejorado con bezier curves
            if (signatureSettings.smoothing && points.length >= 3) {
                // Guardar estilo actual
                const currentThickness = ctx.lineWidth;
                const currentColor = ctx.strokeStyle;
                
                ctx.beginPath();
                ctx.moveTo(points[0].x, points[0].y);
                
                // Dibujar curvas suavizadas
                for (let i = 1; i < points.length - 2; i++) {
                    const current = points[i];
                    const next = points[i + 1];
                    
                    // Punto medio para suavizado
                    const cp1x = current.x;
                    const cp1y = current.y;
                    const cp2x = (current.x + next.x) / 2;
                    const cp2y = (current.y + next.y) / 2;
                    
                    // Ajustar grosor seg√∫n presi√≥n si est√° disponible
                    if (current.pressure && current.pressure !== 1) {
                        ctx.lineWidth = currentThickness * current.pressure;
                    }
                    
                    ctx.quadraticCurveTo(cp1x, cp1y, cp2x, cp2y);
                }
                
                // √öltimo punto
                if (points.length > 1) {
                    const last = points[points.length - 1];
                    ctx.lineTo(last.x, last.y);
                }
                
                ctx.stroke();
                
                // Restaurar grosor original
                ctx.lineWidth = currentThickness;
            } else {
                // Dibujo simple para primeros puntos o cuando hay pocos puntos
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(coords.x, coords.y);
                ctx.stroke();
            }
            
            lastX = coords.x;
            lastY = coords.y;
        }
        
        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                points = [];
                lastX = 0;
                lastY = 0;
                
                // Asegurar que se remueva la clase signing
                setTimeout(() => {
                    if (document.body.classList.contains('signing')) {
                        document.body.classList.remove('signing');
                    }
                }, 200);
                
                // Verificar si hay firma
                const canvas = signatureCanvases['clientDigitalSignature'];
                if (canvas) {
                    const ctx = signatureContexts['clientDigitalSignature'];
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const hasSignature = imageData.data.some((pixel, index) => index % 4 === 3 && pixel > 0);
                    
                    if (hasSignature) {
                        updateSignatureStatus('‚úì Signature ready to save', '#28a745');
                    } else {
                        updateSignatureStatus('', '');
                    }
                }
            }
        }
        
        function clearSignature(type) {
            let canvasId;
            switch(type) {
                case 'clientDigital':
                    canvasId = 'clientDigitalSignature';
                    break;
                case 'preparer':
                    canvasId = 'preparerSignatureCanvas';
                    break;
                default:
                    return;
            }
            
            const canvas = signatureCanvases[canvasId];
            const ctx = signatureContexts[canvasId];
            if (canvas && ctx) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Ocultar validaci√≥n si se limpia la firma del cliente
            if (type === 'clientDigital') {
                document.getElementById('signatureValidation').hidden = true;
            }
        }
        
        function saveSignature(type) {
            if (type === 'clientDigital') {
                const canvas = signatureCanvases['clientDigitalSignature'];
                const signerName = document.getElementById('digitalSignerName').value;
                
                // Verificar checkboxes
                const confirmIdentity = document.getElementById('confirmIdentity').checked;
                const confirmAccuracy = document.getElementById('confirmAccuracy').checked;
                const confirmTerms = document.getElementById('confirmTerms').checked;
                const confirmAuthorization = document.getElementById('confirmAuthorization').checked;
                
                if (!signerName) {
                    alert('‚ö†Ô∏è Please enter your full name');
                    return;
                }
                
                if (!confirmIdentity || !confirmAccuracy || !confirmTerms || !confirmAuthorization) {
                    alert('‚ö†Ô∏è Please confirm all checkboxes');
                    return;
                }
                
                // Verificar que el canvas tenga contenido
                const ctx = signatureContexts['clientDigitalSignature'];
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const hasSignature = imageData.data.some((pixel, index) => index % 4 === 3 && pixel > 0);
                
                if (!hasSignature) {
                    alert('‚ö†Ô∏è Please draw your signature in the box');
                    updateSignatureStatus('‚ö†Ô∏è Signature required', '#dc3545');
                    return;
                }
                
                // Generar hash de verificaci√≥n
                const timestamp = new Date().toISOString();
                const signatureData = canvas.toDataURL();
                const hashInput = signerName + timestamp + signatureData.substring(0, 100);
                const hash = generateSimpleHash(hashInput);
                
                // Mostrar validaci√≥n
                document.getElementById('signatureValidation').hidden = false;
                document.getElementById('signatureHash').textContent = 'Hash: ' + hash + ' | ' + timestamp;
                
                // Guardar en localStorage
                localStorage.setItem('secureAssetsDigitalSignature', JSON.stringify({
                    signerName: signerName,
                    timestamp: timestamp,
                    hash: hash,
                    signatureImage: signatureData
                }));
                
                alert('‚úÖ Digital signature saved successfully');
                updateSignatureStatus('‚úì Signature saved successfully', '#28a745');
            }
        }
        
        // Funci√≥n para descargar la firma como imagen
        function downloadSignature(type) {
            if (type === 'clientDigital') {
                const canvas = signatureCanvases['clientDigitalSignature'];
                const ctx = signatureContexts['clientDigitalSignature'];
                
                // Verificar que haya firma
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const hasSignature = imageData.data.some((pixel, index) => index % 4 === 3 && pixel > 0);
                
                if (!hasSignature) {
                    alert('‚ö†Ô∏è No signature to download. Please sign first.');
                    return;
                }
                
                // Crear imagen
                const dataURL = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                const signerName = document.getElementById('digitalSignerName').value || 'firma';
                const fileName = `firma-digital-${signerName.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.png`;
                
                link.download = fileName;
                link.href = dataURL;
                link.click();
                
                updateSignatureStatus('‚úì Signature downloaded', '#007bff');
            }
        }
        
        // Funci√≥n para cargar imagen de firma desde archivo
        function loadSignatureImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Verificar que sea una imagen
            if (!file.type.match('image.*')) {
                alert('‚ö†Ô∏è Please select a valid image file (JPG, PNG, etc.)');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    drawImageOnCanvas(img, 'clientDigitalSignature');
                };
                img.onerror = function() {
                    alert('‚ö†Ô∏è Error loading image. Please try another image.');
                };
                img.src = e.target.result;
            };
            reader.onerror = function() {
                alert('‚ö†Ô∏è Error reading file. Please try again.');
            };
            reader.readAsDataURL(file);
            
            // Limpiar el input para permitir cargar el mismo archivo de nuevo
            event.target.value = '';
        }
        
        // Funci√≥n para dibujar imagen en el canvas
        function drawImageOnCanvas(img, canvasId) {
            const canvas = signatureCanvases[canvasId];
            const ctx = signatureContexts[canvasId];
            
            if (!canvas || !ctx) {
                alert('‚ö†Ô∏è Error: Canvas no encontrado');
                return;
            }
            
            // Limpiar el canvas primero
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Calcular dimensiones para ajustar la imagen al canvas
            const canvasRect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            const canvasWidth = canvasRect.width * dpr;
            const canvasHeight = canvasRect.height * dpr;
            
            // Calcular escala manteniendo proporci√≥n
            const scale = Math.min(
                canvasWidth / img.width,
                canvasHeight / img.height,
                1 // No hacer la imagen m√°s grande que el original
            );
            
            const scaledWidth = img.width * scale;
            const scaledHeight = img.height * scale;
            
            // Centrar la imagen en el canvas
            const x = (canvasWidth / dpr - scaledWidth) / 2;
            const y = (canvasHeight / dpr - scaledHeight) / 2;
            
            // Aplicar filtro para hacer la imagen m√°s oscura (como tinta)
            ctx.globalCompositeOperation = 'source-over';
            ctx.filter = 'contrast(1.2) brightness(0.8)';
            
            // Dibujar la imagen
            ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
            
            // Restaurar filtro
            ctx.filter = 'none';
            
            // Ocultar hint
            hideHint();
            
            // Actualizar estado
            updateSignatureStatus('‚úì Signature loaded from image', '#28a745');
            
            // Verificar si hay contenido
            setTimeout(() => {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const hasContent = imageData.data.some((pixel, index) => index % 4 === 3 && pixel > 0);
                if (hasContent) {
                    updateSignatureStatus('‚úì Firma lista para guardar', '#28a745');
                }
            }, 100);
        }
        
        // Funci√≥n para manejar pegar desde portapapeles
        function setupPasteHandler() {
            document.addEventListener('paste', function(e) {
                // Verificar si el canvas est√° visible y enfocado
                const canvas = signatureCanvases['clientDigitalSignature'];
                if (!canvas) return;
                
                const items = e.clipboardData.items;
                if (!items) return;
                
                // Buscar imagen en el portapapeles
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf('image') !== -1) {
                        e.preventDefault();
                        const blob = items[i].getAsFile();
                        const reader = new FileReader();
                        
                        reader.onload = function(event) {
                            const img = new Image();
                            img.onload = function() {
                                drawImageOnCanvas(img, 'clientDigitalSignature');
                            };
                            img.onerror = function() {
                                alert('‚ö†Ô∏è Error processing clipboard image.');
                            };
                            img.src = event.target.result;
                        };
                        
                        reader.onerror = function() {
                            alert('‚ö†Ô∏è Error reading clipboard image.');
                        };
                        
                        reader.readAsDataURL(blob);
                        break;
                    }
                }
            });
        }
        
        function generateSimpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'SIG-' + Math.abs(hash).toString(16).toUpperCase().substring(0, 8);
        }
        
        function updateTimestamp() {
            const now = new Date();
            const formatted = now.toLocaleString('es-ES', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const timestampField = document.getElementById('digitalSignTimestamp');
            if (timestampField) {
                timestampField.value = formatted;
            }
        }
        
        // Actualizar timestamp cada segundo
        setInterval(updateTimestamp, 1000);
        
            // Inicializar canvas cuando se carga la p√°gina
            document.addEventListener('DOMContentLoaded', function() {
                // C√≥digo existente...
                // Esperar a que el DOM est√© completamente renderizado
                setTimeout(() => {
                    initSignatureCanvases();
                }, 200);
            });
            
            // Tambi√©n inicializar cuando la ventana se carga completamente
            window.addEventListener('load', function() {
                setTimeout(() => {
                    if (signatureCanvases['clientDigitalSignature']) {
                        const canvas = signatureCanvases['clientDigitalSignature'];
                        const rect = canvas.getBoundingClientRect();
                        const dpr = window.devicePixelRatio || 1;
                        if (canvas.width !== rect.width * dpr || canvas.height !== rect.height * dpr) {
                            initSignatureCanvases();
                        }
                    }
                }, 100);
            });
    </script>
</body>
</html>